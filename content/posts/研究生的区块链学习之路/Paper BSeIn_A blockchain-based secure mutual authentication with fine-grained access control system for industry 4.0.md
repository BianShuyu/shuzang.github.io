---
title: BSeIn:A blockchain-based secure mutual authentication
date: 2019-05-16T14:22:00+08:00
tags: [论文]
categories: [研究生的区块链学习之路]
---

Lin C, He D, Huang X, et al. BSeIn: A blockchain-based secure mutual authentication with fine-grained access control system for industry 4.0[J]. Journal of Network and Computer Applications, 2018, 116: 42-52.

引用量：15

## Abstract

为“工业4.0”时代做准备，我们提出了一个旨在垂直整合各机构间价值网络，工程价值链和制造工厂等的四层框架。该框架帮助我们高效地实施一个灵活且可重新配置的智能工厂。但是，我们需要考虑现有（独立）设备和网络中固有的安全性以及此类集成中可能出现的安全问题。特别是现有的解决方案不足以解决这些基本的安全问题。因此，我们提出了一种基于区块链的用于安全的相互认证的系统BSeIn，以实施细粒度的访问控制策略。论文提出的系统（集成了属性签名，多接收者加密和消息认证代码）旨在提供诸如匿名认证，可审计性和机密性等隐私和安全保证。由于智能合约的使用，BSeIn也可以很好地扩展。然后，我们评估了BSeIn的安全性和性能。性能评估的结果表明，初始化/请求发布/链交易/状态交付/许可更新阶段的成本分别仅为12.123 / 4.810 / 6.978 / 0.013 / 2.559s。

> 系统BSeIn
>
> - 提供细粒度访问控制
> - 安全的相互认证
> - 集成基于属性的签名，多接收者加密，消息认证代码
> - 基于智能合约提供良好的扩展性
>
> 安全评估和性能评估

<!--more-->

## Introduction

虽然有些人将“工业4.0”看作是最近比较热门的词汇，但在数字化的社会中，制造业（以及许多其他工业部门）的自动化和数据交换早已在相互联系和整合。这一点部分得益于物联网（IoT）的发展（Wang等，2016）。一个如图1所示的分层布局可用于促进工业4.0智能工厂的高度灵活性和可重新配置，例如通过互连的CPS更好地增强数据/信息流。

![An example Industry 4 0 smart factory layout](https://user-images.githubusercontent.com/26682846/57853082-6a07fc80-7817-11e9-8c63-74f8aae62521.png)

在这样的布局中，至少有四层结构：一些物理资源（指的是设备节点），一个或多个工业网络，云，以及一些终端（指的是用户节点）。

> 物理资源（即工厂中的设备）可以通过工业网络（有线或无线的）相互连接。基于云的信息系统（如ERP）可以用于接收来自设备的数据或发送相关数据，云也可以通过终端和其它设备或用户交互。比如，用户远程的请求查询云中存在的设备状态信息。

安全性是工业4.0部署中最重要的问题之一，因为制造过程中引入的漏洞（例如硬件特洛伊木马和后门）很难被发现。另外，由于更广泛和更多样化的攻击方式，智能工厂可能比传统的互联网和电商应用更容易被攻破（Qiu等，2011,2012）。例如，具有不同动机，角色和行程的用户（例如客户，供应商和制造商）可以利用终端与基于云的系统进行交互。他们可能会查询数据或尝试控制某些物理资源（工厂设备节点）。或者，攻击者可能通过这些终端应用收集和泄露的敏感信息中寻找有用数据。

因此，不可能设计出能够全面减轻和解决所有安全威胁的方案。本文中，我们只关注访问控制机制，因为许多人认为这是信息系统和数据的“看门人”。通过具有访问控制的安全高效的身份验证机制，我们可以显著减少潜在的网络威胁。

已存在许多从各个角度保证数据安全的方案，例如（Li等人，1109; Li等人，2015; Chen等人，2016; Huang等人，2017）。以及各种身份验证机制，例如基于密码的身份验证（Tsai et al，2006）（最简单和最广泛，用于电子商务系统，但相对较弱），一次性密码身份验证（Haller，1995; M'Raїhi等人，2005; Vaidya等人，2011），基于智能卡的认证（Liu et al，2008）（在商业应用中相对有效），都已在文献中提出。但是，这些机制以及其他机制无法确保以下的基本安全属性（Li和Hwang，2010; Li等，2013）：

- **隐私保护和匿名**：简单的密码身份验证（如上面讨论的那些）并非设计用来保护终端的真实身份这一隐私的，因为恶意或受损的云可以通过交互基于日常活动轻松识别终端身份。
- **细粒度访问控制**：细粒度访问控制通常通过集成一些策略来实现，例如构建用户角色映射表和角色授权表（Sandhu等，1996）。但是，使用这些表的访问控制方法在云端容易受到攻击，因为这些表通常由半可信云维护。
- **完整性和机密性**：终端的访问历史（例如前面讨论的那些）由云记录/存储在本地数据库中。因此，这些数据库可能遭受未经授权的访问和修改，访问记录的可追溯性和可审计性将受到挑战。

> 以上三点总结为：云不安全

### 1.1 动机

为了弥补以上缺陷，我们为工业4.0应用设计了基于区块链的解决方案。在本文中，我们使用智能工厂作为场景进行说明。我们还注意到区块链的潜力已经在许多背景下进行了探索，从数据存储到数据来源，再到身份管理和众筹，等等。这并不奇怪，因为区块链在分布式，可验证性和不变性方面的属性可用于增强安全性（与其他加密工具结合使用），服务可用性（避免单点故障），系统可扩展性（通过智能合约）。

### 1.2 主要贡献

本文主要贡献是基于区块链的系统（BSeIn），该系统用于具有细粒度访问控制的远程相互认证，适用于在工业4.0中部署。在BSeIn中，区块链和属性签名（Maji等，2010）都被集成到匿名认证终端，消息认证码（Bellare等，2000）被用于有效地认证网关。此外，多接收者加密（Islam等，2015）用于提供机密性，即，只有授权参与者（例如，许可节点，云网关，工业网络网关）才能获得对所请求信息“原始”内容的访问权限。为了确保工业4.0应用的可扩展性，我们在BSeIn中使用了智能合约，其中整个请求流程通过与智能合约（即PDHT上的智能合约或第3.6节中描述的TX上的智能合约）进行交互来执行。在讨论BSeIn如何保证这些安全要求之前，我们首先介绍了针对工业4.0部署的基于区块链的相互认证的安全要求有哪些。然后，我们使用基于JUICE的软件模型实施了我们的方案来评估可行性。

> 1. 基于属性的签名用于匿名认证终端，多接收者加密用于提供机密性
> 2. 消息认证码用于认证网关
> 3. 请求通过和智能合约交互执行
> 4. 有哪些安全需求，如何实现这些需求
> 5. 可行性评估使用基于JUICE的软件模型

### 1.3 文章结构

本文的其余部分安排如下。

第2节描述了基于区块链的系统模型和安全需求。

第3节中描述系统构建区块的过程。

第4节和第5节中分别给出BSeIn的安全性分析。

第6节描述了仿真实现并进行了性能评估。

第7节是结论。

## Problem definition

这部分我们引入系统模型和相关的安全需求

### 2.1 系统模型

BSeIn的参与者包括终端、区块链网络、云、工业网络和物理资源，如下图所示。

![Proposed BSeIn system](https://user-images.githubusercontent.com/26682846/57853107-79874580-7817-11e9-94f7-1cc8f11e37c5.png)

- **终端**：终端通常是一些远程通信设备（如移动设备），它们可以远程的请求访问或处理命令，当参与者希望发起请求时，它们需要在区块链网络中发起相应的交易（见3.3节）。

  > 终端就是手机或电脑等用户操作的设备，人们通过它访问区块链或云里的数据，

- **区块链网络**：我们的系统采用fabric实现，其中包括一些处理节点和负责根据共识维护区块链的共识节点（也称作许可节点）。系统采用的共识是PBFT。许可节点又被划分为验证节点（负责验证交易，缩写为vdn）和记录节点（负责将验证的交易链接到区块链，缩写为bkn）。许可节点就来自终端的请求达成共识后，请求将被记录到区块链。区块链网络的细节在3.4节介绍。

- **云**：云中托管了大量的信息系统（如ERP），收集和处理来自物理资源的海量数据，并响应来自终端的访问数据请求。也就是说，云监视区块链网络并响应终端的数据请求

- **工业网络**：与云相反，工业网络主要负责处理来自终端的请求，并且这种请求主要是控制命令。一旦监视区块链网络的工业网络收到控制请求，它就会和相关的物理资源通信从而执行控制命令并将结果发送到相关终端。

- **物理资源**：物理资源在BSeIn中的功能与传统系统相同，即他们需要通过工业网络将（大量）数据传输到云并执行来自工业网络的控制命令。

> 终端、区块链、云构成外联网。定义访问策略，进行数据请求
>
> 云、工业网络、物理资源构成内联网。自动上传数据，执行控制命令

### 2.2 安全需求

基于现有文献，基于区块链的相互认证和细粒度访问的系统需要满足以下基本安全要求：

- 单一注册：系统应该只需要注册一次即可发布交易。
- 相互认证：系统应提供相互认证（如终端和网关之间），以抵御诸如冒充攻击和中间人攻击等常见攻击。
- 用户匿名：为了保护隐私，系统应当保证终端匿名。从基于区块链的角度看，任何攻击者都无法通过简单的交易分析来确定终端的真实身份。
- 细粒度访问控制：管理者可以更精细地和实时地根据策略授予或撤销对终端的许可。
- 会话密钥协商：为了与参与者安全地通信，系统应支持会话密钥协商。即，可以与他人建立安全连接以协商会话密钥以用于后续通信。
- 完美的前向保密：为了确保先前传输的消息的安全性，应该提供完美的前向保密，其中任何获得通信双方的私钥/公钥的攻击者都无法恢复先前的会话密钥。
- 没有验证者列表：为了最小化通信开销并抵制验证者被盗和拒绝服务攻击，系统应避免使用任何验证者列表。换句话说，应该在系统中实现相互认证而不依赖于验证者列表
- 没有在线注册中心：为了最大限度地降低通信成本，系统应避免使用在线注册中心。也就是说，两个通信实体可以直接相互认证，而不依赖于在线注册中心。
- 中继当前时间戳：要按时间顺序维护区块链，系统应使用信任节点来中继挂起区块中的当前时间戳。也就是说，修改时间戳不被发现的可能性很小。
- 抵御生成碰撞：同时生成两个相同块的可能性很小。也就是说，系统应该能够抵抗生成碰撞并避免子区块链之间的争议
- 抵御拦截和修改：应保护传输消息的完整性，以防止拦截和修改不被发现。
- 抵御劫持：为了确保顺利交易，系统应该减少攻击者劫持交易不被发现的可能性。
- 抵御其他攻击：系统还应设计为确保对常见攻击的抵御能力，如模拟攻击，DDoS攻击，修改攻击，重放攻击和中间人攻击等。

## System building blocks

在本节中，我们将回顾BSeIn中使用的加密机制，并引入权限数据哈希表以实现细粒度的访问控制。我们还介绍了核心区块链组件的设计（即交易，区块链，共识机制和智能合约）。

### 3.1 加密机制

#### 3.1.1 基于属性的签名（Attribute-based signatures, ABS）

在基于属性的签名（ABS）方案中，一组属性被用来来定义签名者，并由属性权威机构生成这些属性相应的证书（Li等人，2010）。除了作为数字签名的基本属性（即真实性，完整性和不可否认性）外，ABS还提供诸如匿名认证和细粒度访问控制之类的属性。因此，我们在BSeIn中用ABS代替ECDSA签名（在比特币系统中使用），以保护隐私和安全。

> 即用ABS替换了比特币系统中原来的数字签名算法ECDSA

在BSeIn系统中，我们采用了ABS最实用的实例化（Maji et al。，2010），其签名恰好包含s + 2组元素（其中s是声明谓词的单调跨度程序（MSP）的大小（Chen和Tang，2013）），并不依赖于Groth-Sahai证明系统（Groth et al。，2008）。为了描述这种结构，我们将回顾该方案中的相关符号。c<sub>max</sub>表示所支持的声明谓词中的单调跨度程序的最大宽度，并且A =Z * <sub>p</sub>表示属性集，其中p是所选循环组的素数阶。然后，我们指定其组件如下。

> 基于属性的签名方案中，签名者声称签名对应一组特定的属性或者某一特定访问控制结构，验证者对此进行验证。

![基于属性的签名方案](https://user-images.githubusercontent.com/26682846/58463273-1d50e980-8166-11e9-9c1c-5207dcc750e4.png)

该方案的安全性在genneric group model下被证明，这一模型是实际应用的基础。

> 该算法论文为：Maji, H.K., Prabhakaran, M., Rosulek, M., 2010. IACR Cryptology ePrint Archive. Attribute-based Signatures, vol. 2010. pp. 595.
>
> 一篇做基于属性签名的中文硕士论文：<http://www.doc88.com/p-0532020891872.html>

#### 3.1.2 多接收者加密（Multi-receivers encryption, MRE）

广播加密（BE）和多接收者加密（MRE）用于在一个实体和一组预先选择的接收者之间建立安全通信（Islam等，2015）。也就是说，可以使用BE / MRE通过开放网络安全地向多个接收者广播公共消息。由于BE / MRE的特殊属性（即消息的机密性和接收者之间的匿名性）以及区块链系统设计的安全性要求（例如交易内容的隐私保护），BE / MRE可以集成到我们的方案中以保护交易的机密性。

> 多接收者加密被用于保护交易的机密性

虽然存在各种BE方案（例如（Fiat等，1993; Boneh等，2005））和MRE方案（例如（Kurosawa等，2002; Bellare等，2003）），但是一个安全的无证书多接收者加密（CL-MRE）更适合于分布式实现。这可以避免单点故障问题，因为它不需要受信任的证书颁发机构（可能会被泄露）来颁发证书。因此，我们建议使用安全高效的CL-MRE，例如Islam等人提出的方案。在BSeIn系统中，没有设计双线性对和map-to-point哈希函数。以下，我们对CL-MRE方案做描述。

![CL-MRE加密](https://user-images.githubusercontent.com/26682846/58463322-32c61380-8166-11e9-948b-2f7c1cda983a.png)

在**计算Diffie-Hellman问题**在计算上难以解决的假设下，该方案不仅提供机密性和匿名性，而且提供前向和后向保密。我们将感兴趣的读者引用（Islam et al。，2015）了解更多详情。

> Islam, S.H., Khan, M.K., Al-Khouri, A.M., 2015. Anonymous and provably secure certificateless multireceiver encryption without bilinear pairing. Secur. Commun.Network. 8 (13), 2214–2231.

### 3.2 权限数据哈希表（Permission data hash table, PDHT）

对于细粒度访问控制，我们引入了PDHT，H：{0,1} <sup>256</sup>→{0,1}<sup> N</sup>×{0,1}<sup> N</sup>（比如hash_of_predicate：谓词×策略），其中N»256并且可以存储足够大的数据。谓词可以映射到多个策略，这表示为了获取策略的许可，在属性上的访问规则需要得到满足。例如，“A和（B或C）”映射到“efID∥all”意味着拥有属性“A”和“B”（或“A”和“C”）的某人可以完全控制设备（例如排气扇exhaust fan），标识为“efID”。PDHT的实现类似于非区块链密钥值存储，其可以安全地存储在云中。只有管理者（即智能合约的所有者）才能通过智能合约调用更新PDHT（参见第3.6节）。

> PDHT就是访问控制的策略表

### 3.3 交易

比特币系统中的交易是交易信息的签名，主要包括发送者的地址，接收者的地址和转账金额。但是，我们系统中的交易用于携带指令，例如查询，存储和操作数据。我们的系统中有两种交易类型，如下所述

1. 请求交易（RTx）：如表1所示，一个请求交易由两个加密机制（CL-MRE和ABS）组成。包括以下信息

   - 'from'为请求的ABS信息，如用于验证ABS签名的谓词
   - ‘to'是目标地址，如智能合约地址
   - 'type'是请求类型，如读/控制
   - 'one_time_pk'是用户用于加密来自云或工业网络的信息的一次性公钥
   - ’device_info'是目标设备标识
   - 'order'是实际的控制命令请求，如'turn on'或者'suspend'，当类型是''读''时，该参数为NULL
   - 'data'是触发智能合约的函数或其它参数

   表1 请求交易的结构

   | from | to   | type | CL-MRE      |             |       |      | ABS  |
   | ---- | ---- | ---- | ----------- | ----------- | ----- | ---- | ---- |
   |      |      |      | one_time_pk | device_info | order | data |      |

   如果用户希望请求或控制设备，则他/她使用CL-MRE和ABS签名来计算相关消息的密文。也就是说，RTx = ABS.Sign（from∥to∥type∥CLMRE.Enc（one_time_pk∥device_info∥order∥data）），其中ABS.Sign和CL-MRE.Enc分别是ABS和CL-MRE的签名和加密算法

   > CL-MRE对一次性工业，设备标识，控制命令请求和data字段加密，ABS对整条消息做签名。

2. 权限更新交易（PuTx）：PuTx用于更新不同谓词的策略以授予或调用权限，该权限具有与RTx类似的结构。不同的地方是由谓词和策略组成的相关消息（如表2所示）。通常，一个谓词对应一个策略（例如，从“（A或B）和（C或D）”到“读取”的映射意味着某人的属性满足“（A或B）和（C或D）”具有读取数据的权限）。因此，，管理者可以通过发布PuTx = ABS.Sign（from∥to∥CLMRE.Enc（predicate∥policy∥data））来更新谓词的策略。

   表2 权限更新交易的结构
   
   | from | to   | CL-MRE    |        |      | ABS  |
   | ---- | ---- | --------- | ------ | ---- | ---- |
   |      |      | predicate | policy | data |      |

> 主要就是交易结构改动，以及ABS和CL-MRE用在这里

### 3.4 区块链

在公有区块链（例如比特币和以太坊）和私有区块链（例如Hyperledger）中，共识机制对于选择矿工来创建新区块都是必不可少的。公有区块链中的典型共识机制是工作量证明（PoW），权益证明（PoS）和委托权益证明（DPoS），私有区块链中是实用拜占庭容错算法（PBFT）和RAFT。在我们的设计中，选择受信任的参与节点维持使用PBFT共识机制的区块链（参见第3.5节）。也就是说，**BSeIn是在一个私有区块链中实现的，它可以在几秒钟内进行数十万次交易**。此外，私有区块链的优势（包括增加的隐私控制和修改gas消耗的能力）对于我们的BSeIn设计更合适。

BSeIn中的区块结构类似于比特币，包含区块号，前一区块的哈希值，Merkle树根和时间戳。由于我们在系统中用PBFT代替PoW，因此可以省略PoW的难度和相应的随机数。注意，前一个区块的散列和时间戳可以防止篡改区块。Merkle树根是该块中所有交易的哈希值，用来保证交易完整性。

### 3.5 PBFT

当网络中节点总数的三分之二以上是诚实的时，PBFT可以容忍拜占庭故障。也就是说，我们假设共识节点和受损节点的总数分别为n和f，如果n> = 3f + 1，则可以成功达成共识。

在这里，我们简要介绍一下我们系统采用的PBFT共识，主要包括以下几个阶段（见图3）。

![Consensus procedure of PBFT](https://user-images.githubusercontent.com/26682846/57853124-8a37bb80-7817-11e9-8b3c-4b122b0beb3a.png)

- 生成区块：一个leader负责生成新的候选区块，在我们的系统中，共识节点轮流生成区块。
- 预备（区块数据）：leader将候选区块广播到其他共识节点。
- 准备（区块哈希）：接收到区块的每个节点将验证其有效性并将携带区块哈希的准备消息广播出去。
- 提交（区块哈希）：在收到足够（超过总节点的2/3的消息数量）的准备消息后，每个节点都计算和广播提交信息给所有节点。
- 导入区块：如果接收到的提交消息的数量大于总节点数的2/3，则节点在候选区块上达成共识。也就是说，区块可以链接到私有区块链中

> 准备和提交消息就是单纯的一个携带区块哈希的消息，用来告诉别的节点已校验完成，其中不包括区块信息

除了上述正常情况操作之外，当leader或共识失败时（例如，leader没有按预期广播预备消息或者所接收的提交消息的数量不足），需要View-Change协议。View-Change协议如下。

![Consensus procedure of a View-Change protocol](https://user-images.githubusercontent.com/26682846/57853145-9754aa80-7817-11e9-80a7-0c30779e7be5.png)

- 查看更改：接收异常消息的每个节点都会向其他共识节点广播ViewChange消息。
- 查看更改确认：收到ViewChange消息后，每个节点都会验证有效性并将ViewChange-ACK消息回复给有效节点。
- 新查看：如果接收到的ViewChange-ACK消息的数量超过节点总数的2/3，则下一轮的领导者向其他共识节点广播NewView消息以处理下一个共识。

### 3.6 智能合约

在BSeIn中，我们部署智能合约来管理PDHT和交易。也就是说，终端可以通过智能合约的交互来检索相关谓词策略和发布请求（读取或控制命令），算法1，3，4中简要描述了相应的智能合约。

## Design of BSeIn

在BSeIn中，终端可以在不泄露真实身份的前提下发起查询请求并有效地确认网关的真实性。这是因为一次性公钥/私钥对和消息认证码确保只有请求者才能“解包”来自合法网关（例如云和工业网络）的响应。在这里，我们讨论包括**初始化，请求发布，链交易，状态交付和权限更新**的设计细节。请注意，以下所有涉及的交易都需要与智能合约交互（即触发智能合约）以调用目标函数。

我们分别将AES.Enc，AES.Dec表示为高级加密标准（AES）（Daemen和Rijmen，2002）的加密和解密算法，而H.MAC表示MAC生成算法（Bellare等，2000）。

- 初始化：该阶段，工厂管理者或相关权威机构初始化系统参数，包括

  - ABS初始化：终端第一次注册时，权威机构基于终端属性使用ABS.AttrGen计算签名密钥
  - CL-MRE初始化：同相关成员（如权限节点，云网关，工业网络网关）交互来生成CL-MRE的公/私钥对。
  - 合约部署

- 请求发布：假设一个终端Alice，希望发布一个对设备的请求，她将执行下列步骤：
  1. 在智能合约中调用getPHDT算法以获得与目标设备的策略对应的目标谓词γ。如果Alice的属性满足谓词，那么她可以发布合理的请求并继续下一步。
  
  2. 通过调用密钥生成算法（表示为PKG）生成新的公钥/私钥对（pku，sku）。根据Alice的要求（即请求交易1中涉及的上下文）为交易构建准备所有参数。例如，“to”由TID填充，“data”为函数uploadTX和参数pk =γ，k = 0，表明此交易将触发“TX上的智能合约”中的函数uploadTX并存储为无效交易uvTx []。
  
3. 使用接收者的公钥pki =（Pi，Ti），i = {1，...，t，cg，ig}执行CL-MRE.Enc算法，并使用她的属性密钥基于ABS.Sign算法对所有数据进行签名。
  
  4. 将此交易广播到区块链网络，目标智能合约给出相应的响应。也就是说，更新“TX上的智能合约”中的无效交易。
  
     > uvTx[]为无效交易列表。所有初始提交都是无效交易，需要经过验证后才会变成有效交易。

- 链交易：该阶段包括两步

  1. 为了验证uvTx[]中的每个交易，验证节点(vdn)首先利用getTX(0)来从”Smart Contract on TX"中获取无效交易uvTX[]。然后，调用CL-MRE.De通过使用他的私钥ski解密uvTx [i]以获取device_info和order。如果uvTx [i]中的嵌入谓词γ被允许用于目标device_info和order，并且所涉及的基于属性的签名在ABS.Ver算法的验证下是有效的，则验证节点使用uploadTX（pk，uvTx [i]，1）将uvTx [i]更新为已验证，其中pk是当前验证节点的公共信息。否则，丢弃它
  2. 记录节点(bkn)利用PBFT共识机制来链接交易。也就是说，当前leader重复执行getTX（1）以查询待处理区块的已验证交易vTx []。然后，如果且仅当总“记录节点数量的至少三分之一批准待处理的区块时，才对该块达成共识。最后，leader将这个区块链接到区块链。

- 状态交付：云和工业网络网关监视区块链中新链接的交易。一旦终端发布新的有效请求，相应的交易就会生成并链接到区块链并由云和工业网络接收。它们根据以下交易类型划分分别响应终端请求：

  1. 当“type”字段为“read”时，云网关负责将数据回复给请求者。他/她首先使用他/她的私钥sk<sub>cg</sub>通过CL-MRE.Dec算法执行解密并获得one_time_pk和device_info字段，其中one_time_pk被表示为pk<sub>u</sub>。然后，从本地云存储中检索关于目标device_info的状态信息或相关消息（称为result_data）。接下来，生成DiffieHellman密钥KEY，然后可以通过调用AES.Enc（表示为EnData = AES.Enc（KEY，result_data）和相应的MAC（表示为MAC = H.MAC（EnData，KEY））来加密result_data。用于提供机密性和认证。即，最终响应是（EnData，MAC）。
  2. 区块链中的其他类型的交易（如"control"）由工业网络网关处理。第一个操作是解密交易，这与云网关的操作相同，但使用他/她的密钥sk<sub>ig</sub>代替。解密得到one_time_pk，device_info，control，他/她与目标资源通信以执行控制命令。然后，在物理资源中配置的不同传感器将执行来自网关的命令并返回执行结果。工业网络网关需要计算密文和MAC，因为上述过程由云网关执行。不同之处在于响应（EnData，MAC）中的EnData和MAC是根据不同的Diffie-Hellman密钥KEY计算的，其中d<sub>ig</sub>是工业网络网关的部分密钥。

  当终端接收（EnData，MAC）时，它首先使用他/她的一次性私钥sk<sub>u</sub>计算Diffie-Hellman密钥KEY（这里，Pi是云的部分公共或工业网络网关）。然后，它重新计算MAC<sub>0</sub> = H.MAC（EnData，KEY）。如果MAC0 = MAC成立，则表示响应不是来自模仿者。因此，它调用AES.Dec（KEY，EnData）来解密EnData并获得有关请求的响应信息。

- 权限更新：如上所述，访问控制主要基于管理者（即“Smart on the PHDT”的部署者）维护的PHDT。管理者可以通过updatePDHT算法自适应地更新PHDT，该算法用于添加，删除，修改谓词以及相应的策略。只有属性满足PHDT中出现的谓词，他/她才能根据匹配的策略查询权限请求。

## 安全分析

基于使用的加密方案（如ABS，MRE，AES和MAC），BSeIn能满足2.2节所述所有安全需求

- 单一注册：管理者在注册阶段为用户（即终端）基于他们的属性生成签名密钥。之后，终端就可以发布请求了，即使其它终端加入或更新也不再需要注册。
- 相互认证：云和工业网络都可以基于终端发布的交易的验证来认证终端（比如，是否属性签名有效）。另外，终端可以通过重新计算MAC来识别合法的云网关和工业网络网关。任何概率多项式时间对手都不能成功地为目标消息伪造有效MAC，因为解决CDH问题在计算上是困难的。显然，BSeIn实现了终端和网关之间的相互认证。
- 用户匿名：使用ABS保护终端的实际身份不泄露，验证属性签名时，只能获得相关身份信息之外的属性。此外，在每次交易期间生成的新的一次性公钥/私钥对可以有效地抵抗重放攻击或保护终端免于监视或收集其网络流量。也就是说，系统可以保证用户隐私不受损害
- 细粒度访问控制：系统中部署的ABS不仅为用户提供匿名性，还实现了细粒度的访问控制。管理器可以预设与策略对应的谓词，这确保只有属性满足谓词的终端才能执行策略。此外，管理员可以在检测到恶意行为时通过更新PDHT来撤销谓词的许可。
- 会话密钥协商：在每次交易期间生成的新的一次性公钥/私钥对用于保护会话，并生成MAC（即用作会话密钥）。这可以验证网关以及确保未来通信中的数据机密性。
- 完美的前向保密：在BSeIn中，即使攻击者成功破坏了终端和云网关或工业网络网关的公钥/私钥对，他/她也只能显示属于当前会话的密文。由于一次性公钥/私钥对在每个会话中是不同的，因此保证了完美的前向保密。
- 无验证者列表：如上所述，相互验证仅需要终端和网关生成公钥/私钥对。然后，这些密钥用于生成密文和MAC以进行身份验证。显然，注册中心没有维护验证者列表。
- 没有在线注册中心：从认证过程中，终端和网关可以在没有注册中心的情况下相互认证。
- 当前时间戳的中继：BSeIn利用硬编码的DNS服务器来中继当前时间戳，这可以避免在没有检测/授权的情况下填充时间戳。
- 抵御生成碰撞：在我们的设计中，我们利用允许的区块链中的PBFT共识机制来链接一个块（即，允许的参与节点负责记录）。因此，没有“分叉”的情况，这有效地避免了块的生成碰撞。
- 抵御拦截和修改：使用终端的基于属性的签名密钥对已发布的交易进行签名。一旦攻击者修改签名，它将使该交易无效。并且MAC绑定到来自网关的响应，这也可以防止对响应进行任何未经授权的修改。因此，所提出的设计具有对拦截和修改的抵御能力。
- 抵御劫持攻击：所有交易都由ABS签名，可以阻止劫持攻击，因为任何概率多项式时间对手都不能在不使签名无效的情况下篡改交易的上下文。
- 抵御其它攻击：
  - 用户模拟攻击：只有合法终端才能为BSeIn中的请求生成有效的属性签名。由于相互认证失败，因此将识别伪装成终端或网关的任何模仿者。然后，当检测到错误行为时，管理员可以撤销谓词的许可。
  - DDoS攻击：BSeIn继承了比特币对DDoS攻击的弹性，例如通过限制块大小和检查交易输入的最大属性签名数。此外，如果在PDHT中授予了谓词，则细粒度访问控制确保终端只能与某些目标资源通信。撤销操作可以根据需要实时执行。
  - 修改攻击：假设攻击者修改了广播交易或响应消息，由于属性签名和MAC，它将被发现并丢弃。
  - 重放攻击：每个请求中由终端生成的新的一次性公钥/私钥对用于加密所请求的结果消息并计算MAC。这可以便于终端和网关检测由于公钥/私钥对的新鲜度引起的任何重放攻击。
  - 中间人攻击：从上面可以看出，BSeIn显然提供了安全的相互身份验证。因此，它能抵御中间人攻击。

## 实验与性能评估

本节实现了BSeIn并评估其性能。BSeIn的主要流程在JUICE（一个开放的服务平台）中实施。该平台不仅支持Solidity，还提供基于Java和Javascript的用户友好的Web /client管理和监控工具。此外，还有一组丰富的加密API调用（例如，同态加密，组签名和零知识证明），用于保护应用隐私。由于JUICE在本研究时未提供ABS和CL-MRE的API，我们将分别量化加密机制和智能合约操作的时间成本。

首先，我们统计了BSeIn的设计和实现过程中的操作（例如调用加密算法，发布和触发智能合约）。另外，我们还将SC-PDHT.deploy表示为PDHT智能合约的部署，SC-TX.deploy表示为TX智能合约的部署，PKG.DH表示Diffie-Hellman密钥生成算法。NULL表示该阶段不需要当前操作。表3总结了系统中涉及的操作。

表3 统计BSeIn设计和实施过程中的操作

![统计BSeIn设计和实施过程中的操作](https://user-images.githubusercontent.com/26682846/58463390-52f5d280-8166-11e9-9e7b-0c79234abc26.png)

然后，我们调查了加密算法（如ABS，CL-MRE, ABS和MAC）的时间消耗。在这里，我们利用基于配对的库（版本0.5.12）和GNU多精度算术库（版本6.0.0a）进行模拟，表4展示了仿真平台的相关信息。测量结果以1000次试验的平均值给出，表5列出了结果。注意，我们在ABS的仿真中使用简单的谓词“（A和B）或C“和r = 3，c = 2，并且三个接收者t = 3CL-MRE。

表4 Simulation platform

![Simulation platform](https://user-images.githubusercontent.com/26682846/58463414-643edf00-8166-11e9-8142-922642289666.png)

表5 加密算法的时间花费

![Time cost of cryptographic algorithms](https://user-images.githubusercontent.com/26682846/58463473-820c4400-8166-11e9-804c-5437d0c01517.png)

我们还开发了一个基于JUICE的软件模型来评估BSeIn，如以下步骤所示：

1. 我们利用JUICE（客户端版本）构建一个私有测试链，其中仅包含三个服务器中的权限节点。如表6所示，服务器配置主要包括nginx-1.11.3（高性能HTTP和反向代理服务器），truffle-2.1.1（以太坊的开发框架）和JUICE-client（JUICE客户端版本），其中只需要部署nginx-1.11.3在主节点(例如No.1)。而nginx-1.11.3和JUICE-client部署在所有服务器中。此外，应安装JUICE客户端软件（Microsoft Windows版本）以管理和监控链中的交易或合约。由于页面长度限制，我们将省略部署过程的详细信息

   ![Information of permissioned nodes in the private test chain](https://user-images.githubusercontent.com/26682846/58463510-918b8d00-8166-11e9-8d69-6731f152670a.png)

2. 我们使用solidity在BSeIn中部署智能合约（例如PDHT和TX）。请注意，智能合约通过许可节点在本地计算机上发布（有关系统信息，请参见表4）（在我们的模拟中选择No.1）。使用Web3j（用于Java应用程序的轻量级库），可以轻松地将合约放在测试链上，而无需为Java和Solidity编写其他集成代码。

3. 由于Solidity仅提供高达一秒的准确度，我们使用shell脚本而不是javascript获得时间花费。为了保持一致性，我们还运行了1000次测试来测量与智能合约相关的操作的大致时间成本（即SCPDHT.deploy，SC-TX.deploy，uploadTX，getTX，updatePDHT，getPDHT）。研究结果见表7。

![Table 7 Time cost of cryptographic algorithms](https://user-images.githubusercontent.com/26682846/58463541-a1a36c80-8166-11e9-9bc1-f95564db58f0.png)

表8根据表3中的总结和表5和表7中相应的运行时间成本总结了每个阶段BSeIn的时间花费。我们可以发现主要时间成本是由于智能合约的操作，特别是合约部署。因此，BSeIn中所有阶段（除了状态交付）的时间成本以秒为单位。人类用户可能无法容忍这种延迟，但在JUICE中，每个函数调用等同于发布交易。换句话说，调用结果在链接到区块链后返回。此外，测试时间成本包括交易生成时间，也就是说，我们的仿真是以JUICE定义的交易格式填充数据。因此，所有阶段中的时间花费，除初始化外，如果使用专为BSeIn设计的专用平台，则应以毫秒为单位。

![Time cost of phases in BSeIn](https://user-images.githubusercontent.com/26682846/58463564-ac5e0180-8166-11e9-8e4f-a61d4c086051.png)

## 结论

工业4.0不是一个遥不可及的概念，这种工业4.0系统的复杂性将需要更强大的安全解决方案。

为了为工业4.0应用建立一个具有细粒度访问控制的安全远程用户身份验证，我们在本文中提出了一种新的基于区块链的框架（BSeIn）。该框架利用区块链的基础特征以及若干加密机制来实现分布式的，隐私保护和可审计的解决方案。具体来说，我们利用ABS（匿名验证终端），MAC（有效验证网关）和CL-MRE（提供所请求消息的机密性）。然后我们展示了BSeIn的安全性并评估了原型的性能。

未来的研究将包括探索使用硬件实现优化所提议系统的性能，并与智能工厂运营商合作，在现实环境中实施和评估我们的原型（最可能是基于混合硬件和软件的原型）。

## 个人看法

2019.05.29，对上文基于属性的签名（Attribute-based signatures, ABS）和多接收者加密（Multi-receivers encryption, MRE）两种加密机制的作用分析，以及对这篇论文的优点和不足做总结，虽然还是没怎么看懂

### 1. ABS

BSeIn中使用的ABS是Maji等人2010年的论文[Attribute-Based Signatures]([https://eprint.iacr.org/2010/595.pdf?origin%253Dpublication_detail](https://eprint.iacr.org/2010/595.pdf?origin%3Dpublication_detail))中的方案。该论文中，ABS的应用场景定义为：

爱丽丝是一家大公司的财务经理，在浏览公司的财务记录时，了解到一个重大的国际丑闻。她决定将这些记录发送给一家主流报纸，保证她自己的匿名性，但要证明她确实可以访问这些记录。事实上，由于各种原因，有几个人都可以访问这些记录：这些分布在纽约，伦敦或东京办事处的人员，他们可能是与Skam项目相关的财务经理，或者是内部审计员。爱丽丝考虑使用**环签名**保证她的匿名，但意识到这不可行，不仅因为涉及的人数众多，而且因为她不知道这些人是谁。她意识到她也不能使用**组签名**，因为这件事涉及的人群相对她的目的是特殊的，并且可能并没有被划分到一个群组中。她还想到了网格签名，但是，**网格签名**无法使报纸相信该财务记录是由单独一个人访问到的，而不是纽约办事处的程序员与Smalltown办公室的内部审计员勾结。

爱丽丝在这个故事中的需求反映了系统中面临的挑战，在这个系统中，用户的角色取决于他们拥有的属性的联合。在这样的系统中，用户从一个或多个属性权威机构那里获取多个属性，他的能力（发送或接收消息，访问资源）都取决于其属性。

> 环签名和组签名仅能说明消息由可能的签名者列表中的一个人签名。
>
> 环签名中，列表是公共的，由签名者自组织网络（ad hoc）选择，并明确给出。
>
> 组签名中，群组必须实现由组管理者给出，组管理者可以撤销任意成员的匿名性。

#### ABS的作用

ABS作为一种数字签名，基本作用是保证信息的真实性、完整性和不可否认性。

ABS本身提供匿名和基于属性的细粒度访问控制

在BSeIn系统中，ABS替代了ECDSA（椭圆曲线数字签名算法），主要用来保证用户节点的隐私，以及基于ABS中的属性通过区块链中的智能合约提供细粒度访问控制。

认证是通过数字签名的本身特性带来的，ECDSA同样完成认证，不是ABS的优点。

> 一篇做ABS方向的中文硕士论文，对该方向做了完整描述。[基于属性签名方案的研究](<http://www.doc88.com/p-0532020891872.html>)

#### 在区块链中的位置

用于加密交易，交易结构如下：

| from | to   | type | CL-MRE      |             |       |      | ABS  |
| ---- | ---- | ---- | ----------- | ----------- | ----- | ---- | ---- |
|      |      |      | one_time_pk | device_info | order | data |      |

以上字段都是交易中的内容。ABS用于对整个交易加密。加密后的密文才会广播出去。

也用于访问控制。BSeIn中访问控制通过权限数据哈希表（Permission data hash table）实现。该表的一个例子是：

A和（B或C）”映射到“efID∥all”意味着拥有属性“A”和“B”（或“A”和“C”）的某人可以完全控制设备（例如排气扇exhaust fan），标识为“efID

### 2. 多接收者加密

准确的说，BSeIn中使用的是无证书多接收者加密(CL-MRE)。具体方案来自于Islam等人2014年的论文[Anonymous and provably secure certificateless multireceiver encryption without bilinear pairing](<https://onlinelibrary.wiley.com/doi/full/10.1002/sec.1165>)。CL-MRE的应用场景在该论文中描述如下：

最近，由于信息和通信技术以及分布式网络的巨大发展，互联网上已经部署了一些组播应用，包括付费电视，流音频/视频，加密电子邮件系统，软件保护，版权资料的分发和在线游戏。据观察，互联网从一开始就是开放性的，对被动和主动攻击是不安全的。与点对点通信的安全性相比，互联网组播应用需要解决几个安全问题。在这些场景中，需要安全且有效的方案来将数字内容安全地分发给一组选择的用户，以便他们只能获得并验证该消息。将公共消息安全地传递给一组接收者是一项具有挑战性的任务，可以使用广播加密（BEN）方案或多接收者加密（MRE）方案来实现。

在MRE / BEN方案中，发送方通过加密公共消息m产生密文δ，然后将δ发送给一组t个选择的接收者ID1，ID2，...，IDt。当通过任何公共信道传输加密消息时，实现机密性和接收者匿名性更具挑战性。机密性包括仅允许授权的接收者ID1，ID2，...，IDt解密密文δ并验证消息m的正确性。另一方面，身份保护或接收者匿名包括该组的任何接收者都不能识别其他接收者的身份。

可以基于对称密钥或基于证书的授权机构来实现BEN/MRE方案，该论文实现的是不使用双线性配对和MTP哈希函数的无证书多接收者加密。

#### CL-MRE的作用

主要用于通过开放网络安全的向多个接收者广播公共消息。可以不需要证书颁发机构。并且提供了前向和后向保密。

在BSeIn中是为了保证交易的某些内容只对有权限的实体公开。

#### 在区块链中的位置

| from | to   | type | CL-MRE      |             |       |      | ABS  |
| ---- | ---- | ---- | ----------- | ----------- | ----- | ---- | ---- |
|      |      |      | one_time_pk | device_info | order | data |      |

CL-MRE负责对请求交易中的某些字段做加密，包括一次性公钥，目标设备标识，控制命令和调用的函数。权限更新交易中，加密的内容包括属性和策略，调用的函数。

### 3. BSeIn方案优缺点

优点主要是提出了一个明确的针对智能工厂的架构，能抵御诸多安全攻击，核心是保证了用户节点的匿名性，以及实现了相互认证。

缺点（个人观点）包括：

1. 架构中云的存在冗余。该架构中云依然作为一种存储或应用存在，事实上其作用可以被区块链代替。基于云的应用可以替换为区块链中的Dapp应用。存储可以替换为区块链中的分布式存储。
2. 对隐私过于看重（或许这正是作者想解决的问题）。该论文利用区块链的基础特征和若干加密机制实现了分布式，隐私保护和可审计的解决方案。核心在于对隐私问题的解决。该问题实际上不是BC和IIoT结合所面临的优先级最高的问题。