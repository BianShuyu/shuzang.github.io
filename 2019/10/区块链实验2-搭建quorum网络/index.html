<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>区块链实验2-搭建quorum网络 | Shuzang&#39;s Blog</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta name=Description content="shuzang's personal blog"><link rel=prev href=https://shuzang.github.io/2019/09/git%E5%AD%A6%E4%B9%A0-%E5%AD%90%E6%A8%A1%E5%9D%97%E7%AE%A1%E7%90%86%E4%B8%8E%E4%BD%BF%E7%94%A8/><link rel=next href=https://shuzang.github.io/2019/10/when-intrusion-detection-meets-blockchain-technology-a-review/><link rel=canonical href=https://shuzang.github.io/2019/10/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%9E%E9%AA%8C2-%E6%90%AD%E5%BB%BAquorum%E7%BD%91%E7%BB%9C/><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><meta name=twitter:card content="summary"><meta name=twitter:title content="区块链实验2-搭建quorum网络"><meta name=twitter:description content="一. 前言 之前使用两台电脑和两台树莓派搭建quorum网络，但到最后由于网络质量的问题，共识无法正常运行，导致合约部署无法完成。 INFO [09-14|10:56:00.419] Commit new mining work number=1"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"区块链实验2-搭建quorum网络","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/shuzang.github.io\/2019\/10\/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%9E%E9%AA%8C2-%E6%90%AD%E5%BB%BAquorum%E7%BD%91%E7%BB%9C\/"},"image":{"@type":"ImageObject","url":"https:\/\/shuzang.github.io\/cover.png","width":800,"height":600},"genre":"posts","keywords":"区块链开发","wordcount":5534,"url":"https:\/\/shuzang.github.io\/2019\/10\/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%9E%E9%AA%8C2-%E6%90%AD%E5%BB%BAquorum%E7%BD%91%E7%BB%9C\/","datePublished":"2019-10-02T00:00:00\x2b00:00","dateModified":"2019-10-02T00:00:00\x2b00:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"shuzang","logo":{"@type":"ImageObject","url":"https:\/\/shuzang.github.io\/logo.png","width":127,"height":40}},"description":""}</script><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/css/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/css/lib/animate/animate.min.css></head><body><script>window.isDark=(window.localStorage&&window.localStorage.getItem('theme'))==='dark';window.isDark&&document.body.classList.add('dark-theme');</script><div class=wrapper><nav class=navbar><div class=navbar-container><div class="navbar-header animated bounceIn"><a href=https://shuzang.github.io>Shuzang&#39;s Blog</a></div><div class=navbar-menu><a class=menu-item href=https://shuzang.github.io/posts>Posts</a><a class=menu-item href=https://shuzang.github.io/categories>Categories</a><a class=menu-item href=https://shuzang.github.io/tags>Tags</a><a class=menu-item href=https://shuzang.github.io/life>Life</a><a class=menu-item href=https://shuzang.github.io/about>About</a><a href=javascript:void(0); class=theme-switch><i class="fas fa-adjust fa-rotate-180 fa-fw" title="Switch Theme"></i></a></div></div></nav><nav class=navbar-mobile><div class=navbar-container><div class=navbar-header><div class="navbar-header-title animated bounceIn"><a href=https://shuzang.github.io>Shuzang&#39;s Blog</a></div><div class=menu-toggle id=menu-toggle><span></span><span></span><span></span></div></div><div class=navbar-menu id=mobile-menu><a class=menu-item href=https://shuzang.github.io/posts>Posts</a><a class=menu-item href=https://shuzang.github.io/categories>Categories</a><a class=menu-item href=https://shuzang.github.io/tags>Tags</a><a class=menu-item href=https://shuzang.github.io/life>Life</a><a class=menu-item href=https://shuzang.github.io/about>About</a><a href=javascript:void(0); class=theme-switch><i class="fas fa-adjust fa-rotate-180 fa-fw" title="Switch Theme"></i></a></div></div></nav><main class=main><div class=container><article class=page><h1 class="post-title animated flipInX">区块链实验2-搭建quorum网络</h1><div class=post-meta><div class=post-meta-main><a class=author href=https://shuzang.github.io rel=author target=_blank><i class="fas fa-user-circle fa-fw"></i>shuzang
</a>&nbsp;<span class=post-category>included in&nbsp;<i class="far fa-folder fa-fw"></i><a href=https://shuzang.github.io/categories/%E7%A0%94%E7%A9%B6%E7%94%9F%E7%9A%84%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF/>研究生的区块链学习之路</a>&nbsp;</span></div><div class=post-meta-other><i class="far fa-calendar-alt fa-fw"></i><time datetime=2019-10-02>2019-10-02</time>&nbsp;
<i class="fas fa-pencil-alt fa-fw"></i>about 5534 words&nbsp;
<i class="far fa-clock fa-fw"></i>12 min&nbsp;</div></div><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#一-前言>一. 前言</a><ul><li><a href=#1-设备和操作系统选择>1. 设备和操作系统选择</a></li><li><a href=#2-静态ip分配>2. 静态ip分配</a></li></ul></li><li><a href=#二-台式电脑环境设置>二、台式电脑环境设置</a><ul><li><a href=#1-更新源和系统>1. 更新源和系统</a></li><li><a href=#2-调整系统时间>2. 调整系统时间</a></li><li><a href=#3-设置主机名>3. 设置主机名</a></li><li><a href=#4-设置静态ip>4. 设置静态ip</a></li><li><a href=#5-安装golang>5. 安装golang</a></li><li><a href=#6-安装geth-for-quorum>6. 安装geth for quorum</a></li><li><a href=#7-获取并编译istanbul-tools>7. 获取并编译istanbul-tools</a></li></ul></li><li><a href=#三-树莓派启动及环境配置>三. 树莓派启动及环境配置</a><ul><li><a href=#1-树莓派启动>1. 树莓派启动</a></li><li><a href=#2-树莓派基本配置>2. 树莓派基本配置</a></li></ul></li><li><a href=#四-私链网络搭建及测试运行>四. 私链网络搭建及测试运行</a><ul><li><a href=#1-台式电脑>1. 台式电脑</a></li><li><a href=#2-树莓派>2. 树莓派</a></li></ul></li><li><a href=#参考>参考</a></li></ul></li></ul></nav></div></div><div class=post-toc-mobile id=post-toc-mobile><details><summary><div class=post-toc-title><span>Contents</span>
<span><i class="details icon fas fa-angle-down"></i></span></div></summary><div class=post-toc-content><nav id=TableOfContentsMobile><ul><li><ul><li><a href=#一-前言>一. 前言</a><ul><li><a href=#1-设备和操作系统选择>1. 设备和操作系统选择</a></li><li><a href=#2-静态ip分配>2. 静态ip分配</a></li></ul></li><li><a href=#二-台式电脑环境设置>二、台式电脑环境设置</a><ul><li><a href=#1-更新源和系统>1. 更新源和系统</a></li><li><a href=#2-调整系统时间>2. 调整系统时间</a></li><li><a href=#3-设置主机名>3. 设置主机名</a></li><li><a href=#4-设置静态ip>4. 设置静态ip</a></li><li><a href=#5-安装golang>5. 安装golang</a></li><li><a href=#6-安装geth-for-quorum>6. 安装geth for quorum</a></li><li><a href=#7-获取并编译istanbul-tools>7. 获取并编译istanbul-tools</a></li></ul></li><li><a href=#三-树莓派启动及环境配置>三. 树莓派启动及环境配置</a><ul><li><a href=#1-树莓派启动>1. 树莓派启动</a></li><li><a href=#2-树莓派基本配置>2. 树莓派基本配置</a></li></ul></li><li><a href=#四-私链网络搭建及测试运行>四. 私链网络搭建及测试运行</a><ul><li><a href=#1-台式电脑>1. 台式电脑</a></li><li><a href=#2-树莓派>2. 树莓派</a></li></ul></li><li><a href=#参考>参考</a></li></ul></li></ul></nav></div></details></div><div class=post-content><a class=post-dummy-target id=一-前言></a><h2>一. 前言</h2><p>之前使用两台电脑和两台树莓派搭建quorum网络，但到最后由于网络质量的问题，共识无法正常运行，导致合约部署无法完成。</p><pre><code class=language-bash>INFO [09-14|10:56:00.419] Commit new mining work                   number=1 sealhash=1305ae…019d90 uncles=0 txs=0 gas=0 fees=0 elapsed=556.954µs
TRACE[09-14|10:56:00.420] Dial error                               task=&quot;staticdial 5e62fd3b39e5ae25 192.168.191.5:30303&quot; err=&quot;dial tcp 192.168.191.5:30303: connect: connection refused&quot;
DEBUG[09-14|10:56:00.421] Can't resolve node                       id=0x8e6a40         err=&quot;discovery is disabled&quot;
TRACE[09-14|10:56:00.421] Dial task done                           task=&quot;staticdial 5e62fd3b39e5ae25 192.168.191.5:30303&quot;
TRACE[09-14|10:56:00.420] handleRequest                            address=0x93C20b1ffA9BF8738BF194d5203e3D2E2A48428d state=&quot;Accept request&quot; seq=1 number=1 hash=23cc4d…b11876
TRACE[09-14|10:56:00.422] Dial error                               task=&quot;staticdial c31b4abe77e8a91a 192.168.191.4:30303&quot; err=&quot;dial tcp 192.168.191.4:30303: connect: connection refused&quot;
</code></pre><p>主要原因估计是PC上的节点装在了虚拟机里，虚拟机又使用桥接模式，导致最后丢包率和延迟都比较高。因此这次对实验做一定的调整，主要有两点：</p><ol><li>撤销laptop的节点，只使用台式机，节点仍然安装在虚拟机中，但不使用桥接模式，而是通过外接无线网卡直接连到网络；</li><li>扩展节点数量到6个，虚拟机中设置4个验证者节点，以端口号区分，两台树莓派分别代表一个普通节点，在之后加入。</li></ol><p>最终使用了两台树莓派和一台计算机搭建完成6节点的quorum网络，仍采用了IBFT共识，未启用隐私管理器。网络拓扑如下：</p><p><img src=https://user-images.githubusercontent.com/26682846/71329597-0b9bbd00-2562-11ea-8ed6-102b74fafe66.png alt=quorum网络拓扑></p><p>注意，当前虚拟机和树莓派都是通过无线网卡接入路由器共享的无线网络(网络名为quorum)</p><a class=post-dummy-target id=1-设备和操作系统选择></a><h3>1. 设备和操作系统选择</h3><p>实验平台共使用了一台台式电脑和两台树莓派。设备和操作系统的详细信息如下，台式电脑的内存和硬盘信息是虚拟机分配的容量。</p><table><thead><tr><th>设备</th><th>CPU</th><th>操作系统</th><th>内存</th><th>硬盘</th></tr></thead><tbody><tr><td>清华同方(台式电脑)</td><td>Intel Core i5-4460, 3.2GHz</td><td>Ubuntu 18.04 LTS(虚拟机)</td><td>2GB</td><td>50GB</td></tr><tr><td>Raspberry Pi 3 Model B Plus</td><td>quad-core ARM Cortex A53, 1.4GHz</td><td>Raspbian Buster</td><td>1GB</td><td>32GB(microSD card)</td></tr><tr><td>Raspberry Pi 3 Model B</td><td>quad-core ARM Cortex A53, 1.2GHz</td><td>Raspbian Buster</td><td>1GB</td><td>16GB(microSD card)</td></tr></tbody></table><a class=post-dummy-target id=2-静态ip分配></a><h3>2. 静态ip分配</h3><p>台式电脑的操作环境是在虚拟机上完成的，涉及到网络相关操作，这里事先对各设备进行静态ip的分配</p><table><thead><tr><th>设备</th><th>主机名</th><th>节点编号</th><th>IP地址</th><th>操作系统</th></tr></thead><tbody><tr><td>清华同方（PC）</td><td>validator</td><td>node0</td><td>192.168.191.2:30300</td><td>Ubuntu 18.04 LTS</td></tr><tr><td>清华同方（PC）</td><td>validator</td><td>node1</td><td>192.168.191.2:30301</td><td>Ubuntu 18.04 LTS</td></tr><tr><td>清华同方（PC）</td><td>validator</td><td>node2</td><td>192.168.191.2:30302</td><td>Ubuntu 18.04 LTS</td></tr><tr><td>清华同方（PC）</td><td>validator</td><td>node3</td><td>192.168.191.2:30303</td><td>Ubuntu 18.04 LTS</td></tr><tr><td>Pi 3B+</td><td>lightnode1</td><td>node4</td><td>192.168.191.3</td><td>Raspbian Buster</td></tr><tr><td>Pi 3B</td><td>lightnode2</td><td>node5</td><td>192.168.191.4</td><td>Raspbian Buster</td></tr></tbody></table><a class=post-dummy-target id=二-台式电脑环境设置></a><h2>二、台式电脑环境设置</h2><p>在VMware中安装Ubuntu 18.04虚拟机，安装完成后完成如下基础配置操作：</p><a class=post-dummy-target id=1-更新源和系统></a><h3>1. 更新源和系统</h3><p>根据自己需要选择是否更换软件源，此处我使用了原生的源</p><pre><code class=language-bash>$ sudo apt-get update
$ sudo apt-get upgrade
</code></pre><a class=post-dummy-target id=2-调整系统时间></a><h3>2. 调整系统时间</h3><p>查看系统时区是否正确</p><pre><code class=language-bash>$ timedatectl
                      Local time: 五 2019-09-13 11:07:13 +08
                  Universal time: 五 2019-09-13 03:07:13 UTC
                        RTC time: 五 2019-09-13 03:07:13
                       Time zone: Asia/Ulaanbaatar (+08, +0800)
       System clock synchronized: yes
systemd-timesyncd.service active: yes
                 RTC in local TZ: no
</code></pre><p>若不正确，使用下列命令设置时区，时区根据自己所处位置调整</p><pre><code class=language-bash>$ timedatectl set-timezone Asia/Shanghai
</code></pre><a class=post-dummy-target id=3-设置主机名></a><h3>3. 设置主机名</h3><pre><code class=language-bash>$ sudo hostnamectl set-hostname validator
</code></pre><p>重启终端查看新的主机名</p><pre><code class=language-bash>$ hostnamectl
   Static hostname: validator
         Icon name: computer-vm
           Chassis: vm
        Machine ID: fea6d1013b564af9ad3667732e5417fc
           Boot ID: 326e1f8c6fd04269803413d6ac7c6167
    Virtualization: vmware
  Operating System: Ubuntu 18.04.3 LTS
            Kernel: Linux 5.0.0-23-generic
      Architecture: x86-64
</code></pre><a class=post-dummy-target id=4-设置静态ip></a><h3>4. 设置静态ip</h3><p>执行<code>ifconfig</code>命令需要安装<code>net-tools</code>工具</p><pre><code class=language-bash>$ sudo apt-get install net-tools
</code></pre><p>Ubuntu18.04必须使用<a href=https://ubuntu.com/blog/ubuntu-bionic-netplan>netplan</a>管理网络，但因为这里是Desktop版，可以可视化设置，所以暂时不需要理解。</p><p>在设置页面选择无线网络，然后点击网络连接的quorum网络的小齿轮图标，进入网络设置页面</p><p><img src=https://user-images.githubusercontent.com/26682846/71355675-c2c42280-25ba-11ea-802c-ead9b76d0ec1.png alt></p><p>点击<code>IPv4</code>选项卡，选择<code>Manual</code>，输入我们之前预先设计的IP<code>192.168.191.2</code>，子网掩码、网关和DNS都做相应的设置，然后点击应用。</p><p><img src=https://user-images.githubusercontent.com/26682846/71355931-99f05d00-25bb-11ea-8f9d-7a2c0f2094c2.png alt></p><p>查看设置好的网络地址</p><pre><code class=language-bash>$ ifconfig
...
wlxb8de5e4dad9c: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 192.168.191.2  netmask 255.255.255.0  broadcast 192.168.191.255
        inet6 fe80::bfba:dc41:82e0:e788  prefixlen 64  scopeid 0x20&lt;link&gt;
        ether b8🇩🇪5e:4d:ad:9c  txqueuelen 1000  (Ethernet)
        RX packets 238  bytes 190654 (190.6 KB)
        RX errors 0  dropped 1  overruns 0  frame 0
        TX packets 261  bytes 36065 (36.0 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</code></pre><p>最后取消有限网络的自动连接，确保网络连接处于<code>quorum</code>无线网络上，不过还需要在每次虚拟机启动时手动断开网卡和主机的连接，然后连到虚拟机上。</p><a class=post-dummy-target id=5-安装golang></a><h3>5. 安装golang</h3><p>获取与安装go1.13</p><pre><code class=language-bash>$ wget https://dl.google.com/go/go1.13.linux-amd64.tar.gz
$ sudo tar -xzf go1.13.linux-amd64.tar.gz -C /usr/local
$ rm go1.13.linux-amd64.tar.gz
</code></pre><p>设置环境变量</p><pre><code class=language-bash>$ sudo nano /etc/profile
# 在打开的文件末尾添加下列语句
export PATH=$PATH:/usr/local/go/bin
</code></pre><p>更新的环境变量在下一次登录之前不会生效，但可以通过下面的命令使其直接生效</p><pre><code class=language-bash>$ source /etc/profile
# 查看生效后的环境变量设置
$ go version
go version go1.13 linux/amd64
</code></pre><p>注：真正生效必须重启系统</p><a class=post-dummy-target id=6-安装geth-for-quorum></a><h3>6. 安装geth for quorum</h3><p>获取编译后的二进制包</p><pre><code class=language-bash>$ wget https://bintray.com/quorumengineering/quorum/download_file?file_path=v2.2.5/geth_v2.2.5_linux_amd64.tar.gz
</code></pre><p>解压缩并安装</p><pre><code class=language-bash>$ sudo tar -xzf download_file?file_path=v2.2.5%2Fgeth_v2.2.5_linux_amd64.tar.gz -C /usr/local/bin
$ rm download_file?file_path=v2.2.5%2Fgeth_v2.2.5_linux_amd64.tar.gz
</code></pre><p>测试安装</p><pre><code class=language-bash>$ geth version
WARN [10-11|09:41:31.463] Sanitizing cache to Go's GC limits       provided=1024 updated=655
Geth
Version: 1.8.18-stable
Git Commit: c894c2d70eacf30740d03b53ed2fb39e42641295
Quorum Version: 2.2.5
Architecture: amd64
Protocol Versions: [63 62]
Network Id: 1337
Go Version: go1.11.12
Operating System: linux
GOPATH=
GOROOT=/home/travis/.gimme/versions/go1.11.12.linux.amd64
</code></pre><a class=post-dummy-target id=7-获取并编译istanbul-tools></a><h3>7. 获取并编译istanbul-tools</h3><p>istanbul-tools用来初始化istanbul-BFT共识网络及进行网络测试</p><pre><code class=language-bash>$ sudo apt-get install git
$ mkdir istanbul &amp;&amp; cd istanbul
$ git clone https://github.com/jpmorganchase/istanbul-tools.git
$ cd istanbul-tools
</code></pre><p>执行编译</p><pre><code class=language-bash>$ sudo apt-get install -y build-essential
$ make
</code></pre><p>编译后的文件位于/build/bin目录下，执行测试</p><pre><code class=language-bash>$ ./build/bin/istanbul --version
istanbul version v1.0.1
</code></pre><a class=post-dummy-target id=三-树莓派启动及环境配置></a><h2>三. 树莓派启动及环境配置</h2><p>以Pi 3B+为例，Pi3B配置操作基本相同</p><a class=post-dummy-target id=1-树莓派启动></a><h3>1. 树莓派启动</h3><p>将Raspbian Buster镜像写入准备好的SD卡，重新加载在电脑中的SD卡会出现boot盘，同时也是树莓派的<code>/boot</code>目录。在boot盘根目录新建名为<code>ssh</code>的文件，开启SSH连接。同时新建<code>wpa_supplicant.conf</code>文件，编辑其内容如下：</p><pre><code class=language-bash>ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
country=CN
 
network={
    ssid=&quot;WiFi名&quot;
    psk=&quot;密码&quot;
    priority=10
}
</code></pre><p>将其中的ssid和psk更改为自己无线网络的网络名和密码。将配置好的SD卡卸载并插入树莓派，通电启动。使用Advanced IP Scanner扫描无线网络的网段，获取树莓派ip，本实验无线网络网段为192.168.191.1-254。</p><p>使用扫描到的ip通过Putty利用SSH协议进行登录。</p><a class=post-dummy-target id=2-树莓派基本配置></a><h3>2. 树莓派基本配置</h3><p><strong>(1) 更新源及系统</strong></p><p>编辑/etc/apt/sources.list文件</p><pre><code class=language-bash>sudo nano /etc/apt/sources.list
</code></pre><p>注释掉原来的源，将源更新为：</p><pre><code class=language-bash>deb http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ buster main contrib non-free rpi
deb-src http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ buster main contrib non-free rpi
</code></pre><p>保存退出，编辑/etc/apt/sources.list.d/raspi.list文件</p><pre><code class=language-bash>sudo nano /etc/apt/sources.list.d/raspi.list
</code></pre><p>将源更新为：</p><pre><code class=language-bash>deb http://mirror.tuna.tsinghua.edu.cn/raspberrypi/ buster main ui
deb-src http://mirror.tuna.tsinghua.edu.cn/raspberrypi/ buster main ui
</code></pre><p>更新源文件列表，更新软件</p><pre><code class=language-bash>$ sudo apt-get update
$ sudo apt-get upgrade
</code></pre><p><strong>(2) 安装xrdp供远程连接</strong></p><pre><code class=language-bash>$ sudo apt-get install xrdp
# 确认安装
$ dpkg -l | grep xrdp
ii  xorgxrdp                              1:0.2.9-1                             armhf        Remote Desktop Protocol (RDP) modules for X.org
ii  xrdp                                  0.9.9-1                               armhf        Remote Desktop Protocol (RDP) server
</code></pre><p><strong>(3) 开启ftp供文件传输</strong></p><p>安装vsftpd</p><pre><code class=language-bash>$ sudo apt-get install vsftpd
# 确认安装
$ dpkg -l | grep vsftpd
ii  vsftpd                                3.0.3-12                              armhf        lightweight, efficient FTP server written for security
</code></pre><p>编辑配置文件</p><pre><code class=language-bash>$ sudo nano /etc/vsftpd.conf
</code></pre><p>启用对树莓派的写入权限</p><pre><code class=language-bash># Uncomment this to enable any form of FTP 
write command.write_enable=YES
</code></pre><p>保存退出，启用vsftpd</p><pre><code class=language-bash>$ sudo service vsftpd start
</code></pre><p><strong>(4) 修改pi账户密码，时区和主机名</strong></p><pre><code class=language-bash>$ sudo raspi-config
</code></pre><p>选择第一项<code>Change User Password</code>，键入新密码并确定，</p><p>选择第四项<code>Localisation Options</code>，选择<code>Change Timezone</code>，将时区更改为<code>Asia/Shanghai</code></p><p>全部设置完成后选择<code>Finish</code>退出，终端将看到如下输出</p><pre><code class=language-bash>Current default time zone: 'Asia/Shanghai'
Local time is now:      Fri Sep 13 18:40:56 CST 2019.
Universal Time is now:  Fri Sep 13 10:40:56 UTC 2019.

New password:
Retype new password:
passwd: password updated successfully
OK
</code></pre><p>设置主机名</p><pre><code class=language-bash>$ sudo hostnamectl set-hostname node5
</code></pre><p>编辑/etc/hosts文件，将127.0.1.1对应的raspberry更改为node5</p><pre><code class=language-bash>127.0.0.1       localhost
::1             localhost ip6-localhost ip6-loopback
ff02::1         ip6-allnodes
ff02::2         ip6-allrouters

127.0.1.1       node5
</code></pre><p>退出终端并使用新密码重新登录，主机名将更改为node5。注意此时用户名仍为pi。</p><p><strong>(5) 设置静态ip</strong></p><p>编辑<code>/etc/dhcpcd.conf</code>文件</p><pre><code class=language-bash>$ sudo nano /etc/dhcpcd.conf
</code></pre><p>在末尾添加如下内容</p><pre><code class=language-bash>interface wlan0
 
static ip_address=192.168.191.3/24
static routers=192.168.191.1
static domain_name_servers=192.168.191.1
</code></pre><p>重启并以新的ip登录树莓派。</p><p>(6) 获取并安装geth</p><pre><code class=language-bash>$ git clone -b gethonly https://github.com/shuzang/quorum-raspbian.git
$ cd quorum-raspbian
$ sudo cp geth /usr/local/bin
$ sudo chmod +x /usr/local/bin/geth
</code></pre><p>测试安装是否成功</p><pre><code class=language-bash>$ geth version
WARN [09-13|19:51:40.051] Sanitizing cache to Go's GC limits       provided=1024 updated=308
Geth
Version: 1.8.18-stable
Quorum Version: 2.2.5
Architecture: arm
Protocol Versions: [63 62]
Network Id: 1337
Go Version: go1.11.6
Operating System: linux
GOPATH=
GOROOT=/usr/lib/go-1.11
</code></pre><a class=post-dummy-target id=四-私链网络搭建及测试运行></a><h2>四. 私链网络搭建及测试运行</h2><a class=post-dummy-target id=1-台式电脑></a><h3>1. 台式电脑</h3><p>各节点数据和相关文件的前期生成都在台式电脑中由istanbul-tools工具完成。切换到台式电脑，在istanbul目录下创建各节点的工作目录</p><pre><code class=language-bash>$ cd ~/istanbul
$ mkdir node0 node1 node2 node3
</code></pre><p>进入领导节点（这里是node0）目录，使用istanbul-tools工具为各节点生成文件，该命令会为所有的初始验证者节点生成 <code>static-nodes.json</code>, <code>genesis.json</code>和 nodekeys三种文件。</p><pre><code class=language-bash>$ cd node0
$ ../istanbul-tools/build/bin/istanbul setup --num 4 --nodes --quorum --save --verbose
</code></pre><p>将输出生成的文件信息</p><pre><code class=language-json>validators
{
	&quot;Address&quot;: &quot;0x7fec892a867a2da2e4f1ae1646c29e40d0d7a5c6&quot;,
	&quot;Nodekey&quot;: &quot;d698db367eeb7a43c6eb6c79213482ba6ca6f2781c03e8bc8b6d4d2b9bbfd7e5&quot;,
	&quot;NodeInfo&quot;: &quot;enode://7117f995cdb2d79eb90bc4a575c5f82bbe4aa6ac87f966b18e2e19bd29e728ba9ca85062a6af5c188bb159641392e2ac3559712d9a31e965220659412a4a8c3e@0.0.0.0:30303?discport=0&quot;
}
{
	&quot;Address&quot;: &quot;0x65cc0df8e88fa0fbda0337b3e0b10be9c27325c3&quot;,
	&quot;Nodekey&quot;: &quot;0010d6506fe219d1e0c35f481ee4bd1fc26cadb84c0510128f186e32d7be3f0f&quot;,
	&quot;NodeInfo&quot;: &quot;enode://cb790b57310d70bfb13e417e9dc22f3b0afc0065f4c5babc2f95e3ff75e99d343547585a0b2ad6be6f0497f401e93c16dadec5a68d820cb918fa0255696940f2@0.0.0.0:30303?discport=0&quot;
}
{
	&quot;Address&quot;: &quot;0x786083c93b12404fd4100ec497810b5cfa0a7191&quot;,
	&quot;Nodekey&quot;: &quot;51fbf8274352fe6d39dbe99be75b13a2a882af210e84ea16935a5b52aa68c662&quot;,
	&quot;NodeInfo&quot;: &quot;enode://0e6118122721993e84da84416cb9752a4b5c1b0077a915eb89d0cdff00862c3f13d9edc676c583997f6d9051245ba0f5587750d09d04482774a11f6d13a1c43b@0.0.0.0:30303?discport=0&quot;
}
{
	&quot;Address&quot;: &quot;0x28cd575468829f98dabe99f22fd6f3f09b658700&quot;,
	&quot;Nodekey&quot;: &quot;e2ebbcdb7a82c3cac3f0d25a14b57f21dd4a2616f6797a73ab51e8c10b522055&quot;,
	&quot;NodeInfo&quot;: &quot;enode://8d510973b1b245cb8cec8369948080b7e5adca90730112739307096ab445182415e92967de7096c013644f4b92025c7e29db23a145040cb3b9d46831fab0e8e2@0.0.0.0:30303?discport=0&quot;
}



static-nodes.json
[
	&quot;enode://7117f995cdb2d79eb90bc4a575c5f82bbe4aa6ac87f966b18e2e19bd29e728ba9ca85062a6af5c188bb159641392e2ac3559712d9a31e965220659412a4a8c3e@0.0.0.0:30303?discport=0&quot;,
	&quot;enode://cb790b57310d70bfb13e417e9dc22f3b0afc0065f4c5babc2f95e3ff75e99d343547585a0b2ad6be6f0497f401e93c16dadec5a68d820cb918fa0255696940f2@0.0.0.0:30303?discport=0&quot;,
	&quot;enode://0e6118122721993e84da84416cb9752a4b5c1b0077a915eb89d0cdff00862c3f13d9edc676c583997f6d9051245ba0f5587750d09d04482774a11f6d13a1c43b@0.0.0.0:30303?discport=0&quot;,
	&quot;enode://8d510973b1b245cb8cec8369948080b7e5adca90730112739307096ab445182415e92967de7096c013644f4b92025c7e29db23a145040cb3b9d46831fab0e8e2@0.0.0.0:30303?discport=0&quot;
]



genesis.json
{
    &quot;config&quot;: {
        &quot;chainId&quot;: 10,
        &quot;homesteadBlock&quot;: 0,
        &quot;eip150Block&quot;: 0,
        &quot;eip150Hash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,
        &quot;eip155Block&quot;: 0,
        &quot;eip158Block&quot;: 0,
        &quot;byzantiumBlock&quot;: 0,
        &quot;constantinopleBlock&quot;: 0,
        &quot;istanbul&quot;: {
            &quot;epoch&quot;: 30000,
            &quot;policy&quot;: 0
        },
        &quot;txnSizeLimit&quot;: 64,
        &quot;isQuorum&quot;: true
    },
    &quot;nonce&quot;: &quot;0x0&quot;,
    &quot;timestamp&quot;: &quot;0x5e00998d&quot;,
    &quot;extraData&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000f89af854947fec892a867a2da2e4f1ae1646c29e40d0d7a5c69465cc0df8e88fa0fbda0337b3e0b10be9c27325c394786083c93b12404fd4100ec497810b5cfa0a71919428cd575468829f98dabe99f22fd6f3f09b658700b8410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0&quot;,
    &quot;gasLimit&quot;: &quot;0xe0000000&quot;,
    &quot;difficulty&quot;: &quot;0x1&quot;,
    &quot;mixHash&quot;: &quot;0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365&quot;,
    &quot;coinbase&quot;: &quot;0x0000000000000000000000000000000000000000&quot;,
    &quot;alloc&quot;: {
        &quot;28cd575468829f98dabe99f22fd6f3f09b658700&quot;: {
            &quot;balance&quot;: &quot;0x446c3b15f9926687d2c40534fdb564000000000000&quot;
        },
        &quot;65cc0df8e88fa0fbda0337b3e0b10be9c27325c3&quot;: {
            &quot;balance&quot;: &quot;0x446c3b15f9926687d2c40534fdb564000000000000&quot;
        },
        &quot;786083c93b12404fd4100ec497810b5cfa0a7191&quot;: {
            &quot;balance&quot;: &quot;0x446c3b15f9926687d2c40534fdb564000000000000&quot;
        },
        &quot;7fec892a867a2da2e4f1ae1646c29e40d0d7a5c6&quot;: {
            &quot;balance&quot;: &quot;0x446c3b15f9926687d2c40534fdb564000000000000&quot;
        }
    },
    &quot;number&quot;: &quot;0x0&quot;,
    &quot;gasUsed&quot;: &quot;0x0&quot;,
    &quot;parentHash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;
}
</code></pre><p>查看生成的文件</p><pre><code class=language-bash>$ ls -l
total 24
drwxr-xr-x 2 shuzang shuzang 4096 Dec 23 18:40 0
drwxr-xr-x 2 shuzang shuzang 4096 Dec 23 18:40 1
drwxr-xr-x 2 shuzang shuzang 4096 Dec 23 18:40 2
drwxr-xr-x 2 shuzang shuzang 4096 Dec 23 18:40 3
-rwxr-xr-x 1 shuzang shuzang 1792 Dec 23 18:40 genesis.json
-rwxr-xr-x 1 shuzang shuzang  666 Dec 23 18:40 static-nodes.json
</code></pre><p>使用预定的IP和端口号为所有验证者节点更新 <code>static-nodes.json</code> 文件。 在 <code>static-nodes.json</code>中，每个节点占据一行，按节点标号顺序排列</p><pre><code class=language-bash>$ cat static-nodes.json
....更新ip和端口号如下
[
	&quot;enode://7117f995cdb2d79eb90bc4a575c5f82bbe4aa6ac87f966b18e2e19bd29e728ba9ca85062a6af5c188bb159641392e2ac3559712d9a31e965220659412a4a8c3e@192.168.191.2:30300?discport=0&quot;,
	&quot;enode://cb790b57310d70bfb13e417e9dc22f3b0afc0065f4c5babc2f95e3ff75e99d343547585a0b2ad6be6f0497f401e93c16dadec5a68d820cb918fa0255696940f2@192.168.191.2:30301?discport=0&quot;,
	&quot;enode://0e6118122721993e84da84416cb9752a4b5c1b0077a915eb89d0cdff00862c3f13d9edc676c583997f6d9051245ba0f5587750d09d04482774a11f6d13a1c43b@192.168.191.2:30302?discport=0&quot;,
	&quot;enode://8d510973b1b245cb8cec8369948080b7e5adca90730112739307096ab445182415e92967de7096c013644f4b92025c7e29db23a145040cb3b9d46831fab0e8e2@192.168.191.2:30303?discport=0&quot;
]
</code></pre><p>在每个节点的工作目录创建名为<code>data</code>的数据目录，在<code>data</code>目录创建<code>geth</code>目录</p><pre><code class=language-bash>$ cd ..
$ mkdir -p node0/data/geth
$ mkdir -p node1/data/geth
$ mkdir -p node2/data/geth
$ mkdir -p node3/data/geth
</code></pre><p>挑选部分节点，在各自节点的工作目录为其生成初始账户，账户地址会显示在终端，记住为每个节点账户所设的密码</p><pre><code class=language-bash>$ geth --datadir node0/data account new
WARN [12-23|18:45:02.029] Sanitizing cache to Go's GC limits       provided=1024 updated=655
INFO [12-23|18:45:02.031] Maximum peer count                       ETH=25 LES=0 total=25
Your new account is locked with a password. Please give a password. Do not forget this password.
Passphrase: 
Repeat passphrase: 
Address: {bffe4ff0cbd0a7590fb71966d1e6bb1a4c2359e0}
$ geth --datadir node1/data account new
WARN [12-23|18:45:13.335] Sanitizing cache to Go's GC limits       provided=1024 updated=655
INFO [12-23|18:45:13.337] Maximum peer count                       ETH=25 LES=0 total=25
Your new account is locked with a password. Please give a password. Do not forget this password.
Passphrase: 
Repeat passphrase: 
Address: {dfb9cd6f474188fecbaafb9335d2905f08794612}
$ geth --datadir node2/data account new
WARN [12-23|18:45:26.461] Sanitizing cache to Go's GC limits       provided=1024 updated=655
INFO [12-23|18:45:26.462] Maximum peer count                       ETH=25 LES=0 total=25
Your new account is locked with a password. Please give a password. Do not forget this password.
Passphrase: 
Repeat passphrase: 
Address: {b7ce2bd1cb7232b92220f91aa44bfd48d0d4e806}
$ geth --datadir node3/data account new
WARN [12-23|18:45:35.615] Sanitizing cache to Go's GC limits       provided=1024 updated=655
INFO [12-23|18:45:35.616] Maximum peer count                       ETH=25 LES=0 total=25
Your new account is locked with a password. Please give a password. Do not forget this password.
Passphrase: 
Repeat passphrase: 
Address: {174ec46a6cda172678dfebe0ed8b0c7da685c9a4}
</code></pre><p>为了添加账户到初始区块，使用上述产生的账户地址更新<code>genesis.json</code>文件的<code>alloc</code>字段内容。</p><pre><code class=language-bash>$ cat node0/genesis.json
{
    &quot;config&quot;: {
        &quot;chainId&quot;: 10,
        &quot;homesteadBlock&quot;: 0,
        &quot;eip150Block&quot;: 0,
        &quot;eip150Hash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,
        &quot;eip155Block&quot;: 0,
        &quot;eip158Block&quot;: 0,
        &quot;byzantiumBlock&quot;: 0,
        &quot;constantinopleBlock&quot;: 0,
        &quot;istanbul&quot;: {
            &quot;epoch&quot;: 30000,
            &quot;policy&quot;: 0
        },
        &quot;txnSizeLimit&quot;: 64,
        &quot;isQuorum&quot;: true
    },
    &quot;nonce&quot;: &quot;0x0&quot;,
    &quot;timestamp&quot;: &quot;0x5e00998d&quot;,
    &quot;extraData&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000f89af854947fec892a867a2da2e4f1ae1646c29e40d0d7a5c69465cc0df8e88fa0fbda0337b3e0b10be9c27325c394786083c93b12404fd4100ec497810b5cfa0a71919428cd575468829f98dabe99f22fd6f3f09b658700b8410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0&quot;,
    &quot;gasLimit&quot;: &quot;0xe0000000&quot;,
    &quot;difficulty&quot;: &quot;0x1&quot;,
    &quot;mixHash&quot;: &quot;0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365&quot;,
    &quot;coinbase&quot;: &quot;0x0000000000000000000000000000000000000000&quot;,
    &quot;alloc&quot;: {
        &quot;bffe4ff0cbd0a7590fb71966d1e6bb1a4c2359e0&quot;: {
            &quot;balance&quot;: &quot;0x446c3b15f9926687d2c40534fdb564000000000000&quot;
        },
        &quot;dfb9cd6f474188fecbaafb9335d2905f08794612&quot;: {
            &quot;balance&quot;: &quot;0x446c3b15f9926687d2c40534fdb564000000000000&quot;
        },
        &quot;b7ce2bd1cb7232b92220f91aa44bfd48d0d4e806&quot;: {
            &quot;balance&quot;: &quot;0x446c3b15f9926687d2c40534fdb564000000000000&quot;
        },
        &quot;174ec46a6cda172678dfebe0ed8b0c7da685c9a4&quot;: {
            &quot;balance&quot;: &quot;0x446c3b15f9926687d2c40534fdb564000000000000&quot;
        }
    },
    &quot;number&quot;: &quot;0x0&quot;,
    &quot;gasUsed&quot;: &quot;0x0&quot;,
    &quot;parentHash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;
}
</code></pre><p>将之前步骤中产生的初始化文件移动到相应节点的工作目录。这些文件现在位于领导节点的工作目录。<code>genesis.json</code>放到每个节点的工作目录, <code>static-nodes.json</code>放到每个节点的<code>data</code>目录。<code>X/nodekey</code>放到对应节点的<code>data/geth</code></p><pre><code class=language-bash>$ cp node0/genesis.json node1
$ cp node0/genesis.json node2
$ cp node0/genesis.json node3

$ cp node0/static-nodes.json node0/data/
$ cp node0/static-nodes.json node1/data/
$ cp node0/static-nodes.json node2/data/
$ cp node0/static-nodes.json node3/data/

$ cp node0/0/nodekey node0/data/geth
$ cp node0/1/nodekey node1/data/geth
$ cp node0/2/nodekey node2/data/geth
$ cp node0/3/nodekey node3/data/geth
</code></pre><p>分别在各自节点工作目录执行节点初始化工作</p><pre><code class=language-bash>$ cd node0
$ geth --datadir data init genesis.json
WARN [12-23|18:52:30.425] Sanitizing cache to Go's GC limits       provided=1024 updated=655
INFO [12-23|18:52:30.438] Maximum peer count                       ETH=25 LES=0 total=25
INFO [12-23|18:52:30.439] Allocated cache and file handles         database=/home/shuzang/istanbul/node0/data/geth/chaindata cache=16 handles=16
INFO [12-23|18:52:30.453] Writing custom genesis block 
INFO [12-23|18:52:30.455] Persisted trie from memory database      nodes=5 size=819.00B time=76.952µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B
INFO [12-23|18:52:30.456] Successfully wrote genesis state         database=chaindata                                        hash=afaace…b46039
INFO [12-23|18:52:30.456] Allocated cache and file handles         database=/home/shuzang/istanbul/node0/data/geth/lightchaindata cache=16 handles=16
INFO [12-23|18:52:30.460] Writing custom genesis block 
INFO [12-23|18:52:30.460] Persisted trie from memory database      nodes=5 size=819.00B time=47.175µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B
INFO [12-23|18:52:30.460] Successfully wrote genesis state         database=lightchaindata                                        hash=afaace…b46039

$ cd ../node1
$ geth --datadir data init genesis.json
WARN [12-23|18:53:24.245] Sanitizing cache to Go's GC limits       provided=1024 updated=655
INFO [12-23|18:53:24.246] Maximum peer count                       ETH=25 LES=0 total=25
INFO [12-23|18:53:24.247] Allocated cache and file handles         database=/home/shuzang/istanbul/node1/data/geth/chaindata cache=16 handles=16
INFO [12-23|18:53:24.251] Writing custom genesis block 
INFO [12-23|18:53:24.252] Persisted trie from memory database      nodes=5 size=819.00B time=51.433µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B
INFO [12-23|18:53:24.252] Successfully wrote genesis state         database=chaindata                                        hash=afaace…b46039
INFO [12-23|18:53:24.252] Allocated cache and file handles         database=/home/shuzang/istanbul/node1/data/geth/lightchaindata cache=16 handles=16
INFO [12-23|18:53:24.255] Writing custom genesis block 
INFO [12-23|18:53:24.255] Persisted trie from memory database      nodes=5 size=819.00B time=48.23µs  gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B
INFO [12-23|18:53:24.255] Successfully wrote genesis state         database=lightchaindata                                        hash=afaace…b46039


$ cd ../node2
$ geth --datadir data init genesis.json
WARN [12-23|18:53:52.025] Sanitizing cache to Go's GC limits       provided=1024 updated=655
INFO [12-23|18:53:52.026] Maximum peer count                       ETH=25 LES=0 total=25
INFO [12-23|18:53:52.027] Allocated cache and file handles         database=/home/shuzang/istanbul/node2/data/geth/chaindata cache=16 handles=16
INFO [12-23|18:53:52.032] Writing custom genesis block 
INFO [12-23|18:53:52.032] Persisted trie from memory database      nodes=5 size=819.00B time=76.54µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B
INFO [12-23|18:53:52.032] Successfully wrote genesis state         database=chaindata                                        hash=afaace…b46039
INFO [12-23|18:53:52.032] Allocated cache and file handles         database=/home/shuzang/istanbul/node2/data/geth/lightchaindata cache=16 handles=16
INFO [12-23|18:53:52.035] Writing custom genesis block 
INFO [12-23|18:53:52.035] Persisted trie from memory database      nodes=5 size=819.00B time=44.94µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B
INFO [12-23|18:53:52.035] Successfully wrote genesis state         database=lightchaindata                                        hash=afaace…b46039


$ cd ../node3
$ geth --datadir data init genesis.json
WARN [12-23|18:54:13.106] Sanitizing cache to Go's GC limits       provided=1024 updated=655
INFO [12-23|18:54:13.107] Maximum peer count                       ETH=25 LES=0 total=25
INFO [12-23|18:54:13.108] Allocated cache and file handles         database=/home/shuzang/istanbul/node3/data/geth/chaindata cache=16 handles=16
INFO [12-23|18:54:13.115] Writing custom genesis block 
INFO [12-23|18:54:13.122] Persisted trie from memory database      nodes=5 size=819.00B time=65.787µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B
INFO [12-23|18:54:13.123] Successfully wrote genesis state         database=chaindata                                        hash=afaace…b46039
INFO [12-23|18:54:13.123] Allocated cache and file handles         database=/home/shuzang/istanbul/node3/data/geth/lightchaindata cache=16 handles=16
INFO [12-23|18:54:13.126] Writing custom genesis block 
INFO [12-23|18:54:13.127] Persisted trie from memory database      nodes=5 size=819.00B time=45.203µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B
INFO [12-23|18:54:13.127] Successfully wrote genesis state         database=lightchaindata                                        hash=afaace…b46039

</code></pre><p>通过创建并运行脚本一次启动所有节点</p><pre><code class=language-bash># 当前位于node4目录下，先跳出
$ cd ..
$ nano startall.sh
.... 粘贴以下内容，使端口号符合static-nodes.json中设置的端口号
#!/bin/bash
cd node0
PRIVATE_CONFIG=ignore nohup geth --datadir data --nodiscover --istanbul.blockperiod 5 --syncmode full --mine --minerthreads 1 --verbosity 5 --networkid 10 --rpc --rpcaddr 0.0.0.0 --rpcport 22000 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum,istanbul --ws --wsorigins=&quot;*&quot; --wsaddr 0.0.0.0 --wsport 8545 --emitcheckpoints --port 30300 2&gt;&gt;node.log &amp;


cd ../node1
PRIVATE_CONFIG=ignore nohup geth --datadir data --nodiscover --istanbul.blockperiod 5 --syncmode full --mine --minerthreads 1 --verbosity 5 --networkid 10 --rpc --rpcaddr 0.0.0.0 --rpcport 22001 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum,istanbul --ws --wsorigins=&quot;*&quot; --wsaddr 0.0.0.0 --wsport 8546 --emitcheckpoints --port 30301 2&gt;&gt;node.log &amp;

cd ../node2
PRIVATE_CONFIG=ignore nohup geth --datadir data --nodiscover --istanbul.blockperiod 5 --syncmode full --mine --minerthreads 1 --verbosity 5 --networkid 10 --rpc --rpcaddr 0.0.0.0 --rpcport 22002 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum,istanbul --ws --wsorigins=&quot;*&quot; --wsaddr 0.0.0.0 --wsport 8547 --emitcheckpoints --port 30302 2&gt;&gt;node.log &amp;

cd ../node3
PRIVATE_CONFIG=ignore nohup geth --datadir data --nodiscover --istanbul.blockperiod 5 --syncmode full --mine --minerthreads 1 --verbosity 5 --networkid 10 --rpc --rpcaddr 0.0.0.0 --rpcport 22003 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum,istanbul --ws --wsorigins=&quot;*&quot; --wsaddr 0.0.0.0 --wsport 8548 --emitcheckpoints --port 30303 2&gt;&gt;node.log &amp;

$
See if the any geth nodes are running.
$ ps | grep geth
Kill geth processes
$ killall -INT geth
$
$ chmod +x startall.sh
$ ./startall.sh
$ ps
   PID TTY          TIME CMD
  3740 pts/0    00:00:00 bash
  4057 pts/0    00:00:00 geth
  4058 pts/0    00:00:00 geth
  4059 pts/0    00:00:00 geth
  4060 pts/0    00:00:00 geth
  4119 pts/0    00:00:00 ps
</code></pre><p>第一次启动不需要使用<code>ps</code>和<code>killall</code>命令，只有之后忘记客户端是否启动的时候才需要</p><a class=post-dummy-target id=2-树莓派></a><h3>2. 树莓派</h3><p>以raspberry pi 3B+为例，介绍添加节点到当前网络的操作，raspberry pi 3B操作相似。</p><p>在台式电脑中创建节点工作目录</p><pre><code class=language-bash>$ mkdir node4
</code></pre><p>进入工作目录，生成相关文件</p><pre><code class=language-bash>$ cd node4
$ ../istanbul-tools/build/bin/istanbul setup --num 1 --verbose --quorum --save
validators
{
	&quot;Address&quot;: &quot;0x93b770a0d6f1b4eb8a96daf8a3f1e9a2d860696c&quot;,
	&quot;Nodekey&quot;: &quot;244857df9699fab362c80864888a497caa5d98d48cd87a9cebd12696fcb0289b&quot;,
	&quot;NodeInfo&quot;: &quot;enode://195c4a09528db47ba3625cbb21de2c8f0f15cf1a821a95e2decd46837369e7b1d192a7108b627a3840ece306baba38ca6c11ab0dc236a3542bc56ab9204eb75e@0.0.0.0:30303?discport=0&quot;
}



genesis.json
{
    &quot;config&quot;: {
        &quot;chainId&quot;: 10,
        &quot;homesteadBlock&quot;: 0,
        &quot;eip150Block&quot;: 0,
        &quot;eip150Hash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,
        &quot;eip155Block&quot;: 0,
        &quot;eip158Block&quot;: 0,
        &quot;byzantiumBlock&quot;: 0,
        &quot;constantinopleBlock&quot;: 0,
        &quot;istanbul&quot;: {
            &quot;epoch&quot;: 30000,
            &quot;policy&quot;: 0
        },
        &quot;txnSizeLimit&quot;: 64,
        &quot;isQuorum&quot;: true
    },
    &quot;nonce&quot;: &quot;0x0&quot;,
    &quot;timestamp&quot;: &quot;0x5e00afc6&quot;,
    &quot;extraData&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000f85ad59493b770a0d6f1b4eb8a96daf8a3f1e9a2d860696cb8410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0&quot;,
    &quot;gasLimit&quot;: &quot;0xe0000000&quot;,
    &quot;difficulty&quot;: &quot;0x1&quot;,
    &quot;mixHash&quot;: &quot;0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365&quot;,
    &quot;coinbase&quot;: &quot;0x0000000000000000000000000000000000000000&quot;,
    &quot;alloc&quot;: {
        &quot;93b770a0d6f1b4eb8a96daf8a3f1e9a2d860696c&quot;: {
            &quot;balance&quot;: &quot;0x446c3b15f9926687d2c40534fdb564000000000000&quot;
        }
    },
    &quot;number&quot;: &quot;0x0&quot;,
    &quot;gasUsed&quot;: &quot;0x0&quot;,
    &quot;parentHash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;
}
</code></pre><p>将产生的节点信息添加到node0目录的<code>static-nodes.json</code>文件，设置IP地址和端口号</p><pre><code class=language-json>[
	&quot;enode://7117f995cdb2d79eb90bc4a575c5f82bbe4aa6ac87f966b18e2e19bd29e728ba9ca85062a6af5c188bb159641392e2ac3559712d9a31e965220659412a4a8c3e@192.168.191.2:30300?discport=0&quot;,
	&quot;enode://cb790b57310d70bfb13e417e9dc22f3b0afc0065f4c5babc2f95e3ff75e99d343547585a0b2ad6be6f0497f401e93c16dadec5a68d820cb918fa0255696940f2@192.168.191.2:30301?discport=0&quot;,
	&quot;enode://0e6118122721993e84da84416cb9752a4b5c1b0077a915eb89d0cdff00862c3f13d9edc676c583997f6d9051245ba0f5587750d09d04482774a11f6d13a1c43b@192.168.191.2:30302?discport=0&quot;,
	&quot;enode://8d510973b1b245cb8cec8369948080b7e5adca90730112739307096ab445182415e92967de7096c013644f4b92025c7e29db23a145040cb3b9d46831fab0e8e2@192.168.191.2:30303?discport=0&quot;,
	&quot;enode://195c4a09528db47ba3625cbb21de2c8f0f15cf1a821a95e2decd46837369e7b1d192a7108b627a3840ece306baba38ca6c11ab0dc236a3542bc56ab9204eb75e@192.168.191.3:30303?discport=0&quot;
]
</code></pre><p>复制已运行区块链的<code>static-nodes.json</code>和<code>genesis.json</code>文件到当前节点相应目录</p><pre><code class=language-bash>$ cp ../node0/genesis.json .
</code></pre><p>复制新的<code>static-nodes.json</code>文件到所有节点的<code>data</code>目录</p><pre><code class=language-bash>$ mkdir -p data/geth
$ cp ../node0/static-nodes.json data
$ cd ..
$ cp node0/static-nodes.json node0/data
$ cp node0/static-nodes.json node1/data
$ cp node0/static-nodes.json node2/data
$ cp node0/static-nodes.json node3/data
</code></pre><p>复制之前生成的nodekey到新节点工作目录的geth目录</p><pre><code class=language-bash>$ cd node4
$ cp 0/nodekey data/geth
</code></pre><p>利用win10的远程桌面连接(xrdp已安装)或者ftp等文件(vsftpd已安装)传输协议，将node4整个工作目录复制到raspberry pi 3B+中</p><p>生成节点账户并记录账户地址</p><pre><code class=language-bash>$ cd node4
$ geth --datadir data account new
</code></pre><p>初始化节点</p><pre><code class=language-bash>$ geth --datadir data init genesis.json
</code></pre><p>创建start.sh脚本用于启动节点，脚本基本内容如下</p><pre><code class=language-sh>#!/bin/bash
PRIVATE_CONFIG=ignore nohup geth --datadir data --nodiscover --istanbul.blockperiod 5 --syncmode full --verbosity 5 --networkid 10 --rpc --rpcaddr 0.0.0.0 --rpcport 22000 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum,istanbul --ws --wsorigins=&quot;*&quot; --wsaddr 0.0.0.0 --wsport 8545 --emitcheckpoints --port 30303 2&gt;&gt;node.log &amp;
</code></pre><p>授予start.sh脚本执行权限，执行该脚本</p><pre><code class=language-bash>.... 跳转到脚本所在目录
$ sudo chmod +x start.sh
$ ./start.sh
</code></pre><p>执行完后查找geth进程是否启动，并执行<code>geth attach</code>命令接入geth控制台</p><pre><code class=language-bash>$ ps | grep geth
 16877 pts/0    00:00:01 geth
</code></pre><p>接下来可在任一设备的节点目录下通过websocket进行操作。</p><p>至此利用quorum搭建私链网络完毕，用作之后的实验平台，接下来进行交易验证、合约部署和测试。</p><a class=post-dummy-target id=参考></a><h2>参考</h2><p><a href=https://www.ywlib.com/archives/109.html>解决Hyper-V内虚拟机网络延迟高的问题(ping延时大)</a></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>The article was updated on 2019-10-02</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href="//twitter.com/share?url=https%3a%2f%2fshuzang.github.io%2f2019%2f10%2f%25E5%258C%25BA%25E5%259D%2597%25E9%2593%25BE%25E5%25AE%259E%25E9%25AA%258C2-%25E6%2590%25AD%25E5%25BB%25BAquorum%25E7%25BD%2591%25E7%25BB%259C%2f&amp;text=%e5%8c%ba%e5%9d%97%e9%93%be%e5%ae%9e%e9%aa%8c2-%e6%90%ad%e5%bb%baquorum%e7%bd%91%e7%bb%9c&amp;via=" target=_blank title="Share on Twitter"><i class="fab fa-twitter fa-fw"></i></a><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fshuzang.github.io%2f2019%2f10%2f%25E5%258C%25BA%25E5%259D%2597%25E9%2593%25BE%25E5%25AE%259E%25E9%25AA%258C2-%25E6%2590%25AD%25E5%25BB%25BAquorum%25E7%25BD%2591%25E7%25BB%259C%2f" target=_blank title="Share on Facebook"><i class="fab fa-facebook-square fa-fw"></i></a><a href="//reddit.com/submit?url=https%3a%2f%2fshuzang.github.io%2f2019%2f10%2f%25E5%258C%25BA%25E5%259D%2597%25E9%2593%25BE%25E5%25AE%259E%25E9%25AA%258C2-%25E6%2590%25AD%25E5%25BB%25BAquorum%25E7%25BD%2591%25E7%25BB%259C%2f&amp;title=%e5%8c%ba%e5%9d%97%e9%93%be%e5%ae%9e%e9%aa%8c2-%e6%90%ad%e5%bb%baquorum%e7%bd%91%e7%bb%9c" target=_blank title="Share on Reddit"><i class="fab fa-reddit fa-fw"></i></a></span></div></div></div><div class=post-info-more><section><span class=tag><a href=https://shuzang.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%BC%80%E5%8F%91/><i class="fas fa-tag fa-fw"></i>&nbsp;区块链开发</a>&nbsp;</span></section><section><span><a href=javascript:window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=https://shuzang.github.io>Home</a></span></section></div><div class=post-nav><a href=https://shuzang.github.io/2019/09/git%E5%AD%A6%E4%B9%A0-%E5%AD%90%E6%A8%A1%E5%9D%97%E7%AE%A1%E7%90%86%E4%B8%8E%E4%BD%BF%E7%94%A8/ class=prev rel=prev title="Git学习 子模块管理与使用"><i class="fas fa-angle-left fa-fw"></i>Git学习 子模块管理与使用</a>
<a href=https://shuzang.github.io/2019/10/when-intrusion-detection-meets-blockchain-technology-a-review/ class=next rel=next title="When Intrusion Detection Meets Blockchain Technology A Review">When Intrusion Detection Meets Blockchain Technology A Review<i class="fas fa-angle-right fa-fw"></i></a></div></div><div class=post-comment></div></article></div></main><footer class=footer><div class=copyright><div class=copyright-line>Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreffer">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="external nofollow noopener noreffer">LoveIt<i class="far fa-heart fa-fw"></i></a></div><div class=copyright-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2018 - 2020</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://shuzang.github.io target=_blank>shuzang</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><a href=# class=dynamic-to-top id=dynamic-to-top data-scroll><span>&nbsp;</span>
</a><script src=/js/lib/jquery/jquery.slim.min.js></script><script src=/js/lib/lazysizes/lazysizes.min.js></script><script src=/js/lib/smooth-scroll/smooth-scroll.polyfills.min.js></script><script>window.scroll=new SmoothScroll('[data-scroll]',{speed:300,speedAsDuration:true});</script><link rel=stylesheet href=/css/lib/katex/katex.min.css><script src=/js/lib/katex/katex.min.js></script><script defer src=/js/lib/katex/auto-render.min.js></script><link rel=stylesheet href=/css/lib/katex/copy-tex.min.css><script defer src=/js/lib/katex/copy-tex.min.js></script><script defer src=/js/lib/katex/mhchem.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:true},{left:"\\(",right:"\\)",display:false},{left:"\\[",right:"\\]",display:true},{left:"$",right:"$",display:false},]});});</script><script src=/js/blog.min.js></script></body></html>