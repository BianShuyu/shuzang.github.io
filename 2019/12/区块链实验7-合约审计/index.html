<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>区块链实验7-合约审计 | Shuzang's Blog</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta name=Description content="shuzang's personal blog"><link rel=prev href=https://shuzang.top/2019/12/life-skills-8-clothing-style-development-and-clothing-purchase/><link rel=next href=https://shuzang.top/2019/12/life-skills-9-maintenance-storage-and-disposal-of-used-clothes/><link rel=canonical href=https://shuzang.top/2019/12/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%9E%E9%AA%8C7-%E5%90%88%E7%BA%A6%E5%AE%A1%E8%AE%A1/><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><meta property="og:title" content="区块链实验7-合约审计"><meta property="og:description" content="由于访问控制的核心工作是基于智能合约的，智能合约的安全性显得尤为重要，行业内这方面的研究方向称之为审计，因此当前打算选取合适的自动审计工具来"><meta property="og:type" content="article"><meta property="og:url" content="https://shuzang.top/2019/12/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%9E%E9%AA%8C7-%E5%90%88%E7%BA%A6%E5%AE%A1%E8%AE%A1/"><meta property="article:published_time" content="2019-12-06T00:00:00+00:00"><meta property="article:modified_time" content="2019-12-06T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="区块链实验7-合约审计"><meta name=twitter:description content="由于访问控制的核心工作是基于智能合约的，智能合约的安全性显得尤为重要，行业内这方面的研究方向称之为审计，因此当前打算选取合适的自动审计工具来"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"区块链实验7-合约审计","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/shuzang.top\/2019\/12\/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%9E%E9%AA%8C7-%E5%90%88%E7%BA%A6%E5%AE%A1%E8%AE%A1\/"},"image":{"@type":"ImageObject","url":"https:\/\/shuzang.top\/cover.png","width":800,"height":600},"genre":"posts","keywords":"课题记录","wordcount":1354,"url":"https:\/\/shuzang.top\/2019\/12\/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%9E%E9%AA%8C7-%E5%90%88%E7%BA%A6%E5%AE%A1%E8%AE%A1\/","datePublished":"2019-12-06T00:00:00\x2b00:00","dateModified":"2019-12-06T00:00:00\x2b00:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"shuzang","logo":{"@type":"ImageObject","url":"https:\/\/shuzang.top\/logo.png","width":127,"height":40}},"description":""}</script><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/css/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/css/lib/animate/animate.min.css></head><body><script>window.isDark=(window.localStorage&&window.localStorage.getItem('theme'))==='dark';window.isDark&&document.body.classList.add('dark-theme');</script><div class=wrapper><nav class=navbar><div class=navbar-container><div class="navbar-header animated bounceIn"><a href=https://shuzang.top>Shuzang's Blog</a></div><div class=navbar-menu><a class=menu-item href=https://shuzang.top/posts>Posts</a><a class=menu-item href=https://shuzang.top/categories>Categories</a><a class=menu-item href=https://shuzang.top/tags>Tags</a><a class=menu-item href=https://shuzang.top/life>Life</a><a class=menu-item href=https://shuzang.top/about>About</a><a href=javascript:void(0); class=theme-switch><i class="fas fa-adjust fa-rotate-180 fa-fw" title="Switch Theme"></i></a></div></div></nav><nav class=navbar-mobile><div class=navbar-container><div class=navbar-header><div class="navbar-header-title animated bounceIn"><a href=https://shuzang.top>Shuzang's Blog</a></div><div class=menu-toggle id=menu-toggle><span></span><span></span><span></span></div></div><div class=navbar-menu id=mobile-menu><a class=menu-item href=https://shuzang.top/posts>Posts</a><a class=menu-item href=https://shuzang.top/categories>Categories</a><a class=menu-item href=https://shuzang.top/tags>Tags</a><a class=menu-item href=https://shuzang.top/life>Life</a><a class=menu-item href=https://shuzang.top/about>About</a><a href=javascript:void(0); class=theme-switch><i class="fas fa-adjust fa-rotate-180 fa-fw" title="Switch Theme"></i></a></div></div></nav><main class=main><div class=container><article class=page><h1 class="post-title animated flipInX">区块链实验7-合约审计</h1><div class=post-meta><div class=post-meta-main><a class=author href=https://shuzang.top rel=author target=_blank><i class="fas fa-user-circle fa-fw"></i>shuzang
</a>&nbsp;<span class=post-category>included in&nbsp;<i class="far fa-folder fa-fw"></i><a href=https://shuzang.top/categories/%E7%A0%94%E7%A9%B6%E7%94%9F%E7%9A%84%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF/>研究生的区块链学习之路</a>&nbsp;</span></div><div class=post-meta-other><i class="far fa-calendar-alt fa-fw"></i><time datetime=2019-12-06>2019-12-06</time>&nbsp;
<i class="fas fa-pencil-alt fa-fw"></i>about 1354 words&nbsp;
<i class="far fa-clock fa-fw"></i>3 min&nbsp;<span id=/2019/12/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%9E%E9%AA%8C7-%E5%90%88%E7%BA%A6%E5%AE%A1%E8%AE%A1/ class=leancloud_visitors data-flag-title=区块链实验7-合约审计>
<i class="far fa-eye fa-fw"></i><span class=leancloud-visitors-count></span>pageviews
</span>&nbsp;</div></div><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#正文>正文</a></li><li><a href=#访问控制合约检测结果>访问控制合约检测结果</a></li></ul></nav></div></div><div class=post-toc-mobile id=post-toc-mobile><details><summary><div class=post-toc-title><span>Contents</span>
<span><i class="details icon fas fa-angle-down"></i></span></div></summary><div class=post-toc-content><nav id=TableOfContentsMobile><ul><li><a href=#正文>正文</a></li><li><a href=#访问控制合约检测结果>访问控制合约检测结果</a></li></ul></nav></div></details></div><div class=post-content><p>由于访问控制的核心工作是基于智能合约的，智能合约的安全性显得尤为重要，行业内这方面的研究方向称之为<code>审计</code>，因此当前打算选取合适的自动审计工具来对编写完成的合约进行分析。</p><p>参考文章：<a href=https://learnblockchain.cn/2019/10/15/VaasMythril/ target=_blank>关于形式化验证两大工具 (Vass & Mythril) 测试对比</a></p><p>在经过大量查找后发现，商业化应用的审计工具以上文中的两款最为普及。我们首先使用成都链安的Vass工具进行分析，然而发现，在合约中存在内联汇编时，Vass无法编译合约，更谈不上审计，然而内联汇编在我们的合约中是必要的，因此换用Mythril。</p><p>Mythril 工具是由以太坊开源社区所提供的安全分析工具，github仓库地址为</p><ul><li><a href=https://github.com/ConsenSys/mythril>https://github.com/ConsenSys/mythril</a></li></ul><p>建立在Mythril上的合约分析平台<a href=https://github.com/b-mueller/awesome-mythx-smart-contract-security-tools target=_blank>MythX</a>具有更高的可用性并覆盖了更广泛的安全问题，因此最终使用MythX完成统计分析。</p><a class=post-dummy-target id=正文></a><h2>正文</h2><p>MythX拥有Remix、VScode和Truffle的插件，因此无论以哪种方式编辑合约，都可以轻松的进行安全分析，但首先需要拥有MythX的账户。</p><p>在 <a href=https://dashboard.mythx.io/#/registration>https://dashboard.mythx.io/#/registration</a> 页面使用邮箱进行注册</p><p><figure><img src=/svg/loading.min.svg data-sizes=auto data-src=https://user-images.githubusercontent.com/26682846/70290021-91550400-1811-11ea-901d-e46e5d76d00f.png alt=注册 class=lazyload><figcaption class=image-caption>注册</figcaption></figure></p><p>之后关联MetaMask以太坊账户，MythX将提供一个密码供Remix等工具中的插件使用，也可以自己设定，但设定的密码要求长度为6-64位，至少一个小写字符，一个大写字符，一个数字和一个符号。</p><blockquote><p>Password needs to contain: Length: 8 and 64 characters; One lowercase (a-z) and uppercase (A-Z) letter; One digit (0-9); One symbol (e.g. !"#$%&/()., )</p></blockquote><p>打开Remix界面，在插件列表搜索MythX，点击<code>Activate</code>将插件激活</p><p><figure><img src=/svg/loading.min.svg data-sizes=auto data-src=https://user-images.githubusercontent.com/26682846/70290039-9dd95c80-1811-11ea-81bf-0afb50ce5e9c.png alt=激活插件 class=lazyload><figcaption class=image-caption>激活插件</figcaption></figure></p><p>以Remix自带的示例合约ballot.sol为例，首先编译该合约，然后切换到MythX选项卡，输入之前关联到MythX的以太坊账户地址，MythX提供的或自己更改后的密码，点击<code>Save</code>，然后点击<code>Analyze</code></p><p><figure><img src=/svg/loading.min.svg data-sizes=auto data-src=https://user-images.githubusercontent.com/26682846/70290100-d416dc00-1811-11ea-9eee-5b55d63bcf47.png alt=登录并进行分析 class=lazyload><figcaption class=image-caption>登录并进行分析</figcaption></figure></p><p>经过一段时间的等待后，将可以在<code>Report</code>界面查看到安全分析结果</p><p><figure><img src=/svg/loading.min.svg data-sizes=auto data-src=https://user-images.githubusercontent.com/26682846/70290130-e7c24280-1811-11ea-9cfe-ac270c65ceab.png alt=查看分析结果 class=lazyload><figcaption class=image-caption>查看分析结果</figcaption></figure></p><p>也可以点击上图Log记录中的链接进入MythX Dashboard查看详细结果</p><p><figure><img src=/svg/loading.min.svg data-sizes=auto data-src=https://user-images.githubusercontent.com/26682846/70290165-f872b880-1811-11ea-9249-c14f56fb1f8a.png alt=详细分析结果 class=lazyload><figcaption class=image-caption>详细分析结果</figcaption></figure></p><p>点击<code>Analysed Files</code>查看错误的详细位置与说明，然后更改源代码，重新测试，直到合约安全性达到自己想要的结果。</p><p><figure><img src=/svg/loading.min.svg data-sizes=auto data-src=https://user-images.githubusercontent.com/26682846/70290183-0c1e1f00-1812-11ea-803e-4754134cd36c.png alt=迭代修改 class=lazyload><figcaption class=image-caption>迭代修改</figcaption></figure></p><p>检测到的合约弱点(漏洞)以SWC-XXX编号的形式出现，由 <a href=https://swcregistry.io/>https://swcregistry.io/</a> 可查看完整的安全问题列表和解释。但是，免费的MythX只能检测10种安全问题，Pro版和企业版可以检测26种安全问题，三种版本的区别如下</p><p><figure><img src=/svg/loading.min.svg data-sizes=auto data-src=https://user-images.githubusercontent.com/26682846/70290206-1c35fe80-1812-11ea-96d0-7d99a251e5b8.png alt=版本区别 class=lazyload><figcaption class=image-caption>版本区别</figcaption></figure></p><p>具体对每种安全问题的支持程度见该页面： <a href=https://mythx.io/swc-coverage/>https://mythx.io/swc-coverage/</a></p><p>当前调试过程种，遇到的典型安全问题是 SWC-101:Integer Overflow and Underflow 问题，问题的具体分析可参考 <a href=https://github.com/ethereum/solidity/issues/796 target=_blank>solidity-issue #796</a></p><a class=post-dummy-target id=访问控制合约检测结果></a><h2>访问控制合约检测结果</h2><p>我们所编写的RC，ACC和JC三个合约在经过多次修改后，将出现的安全问题降低到了可接受的程度，如下图所示</p><p><figure><img src=/svg/loading.min.svg data-sizes=auto data-src=https://user-images.githubusercontent.com/26682846/70290241-366fdc80-1812-11ea-82b1-59e36e33ff9a.png alt=访问控制合约检测结果 class=lazyload><figcaption class=image-caption>访问控制合约检测结果</figcaption></figure></p><p>三个合约出现的低级安全问题均为SWC-103: Floating Pragma ，即编译器的版本指定为一个范围，但这样具有更好的适用性，因此不进行修改</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js> <span class=nx>pragma</span> <span class=nx>solidity</span> <span class=o>&gt;=</span><span class=mf>0.4</span><span class=mf>.22</span> <span class=o>&lt;</span><span class=mf>0.6</span><span class=mf>.0</span><span class=p>;</span>
</code></pre></td></tr></table></div></div><p>ACC出现的15个中级安全问题在详情列表中无法查看</p><p><figure><img src=/svg/loading.min.svg data-sizes=auto data-src=https://user-images.githubusercontent.com/26682846/70290259-4ab3d980-1812-11ea-882d-15c929c77f73.png alt=ACC的安全问题 class=lazyload><figcaption class=image-caption>ACC的安全问题</figcaption></figure></p><p>邮件询问后官方的回复如下，字节码级别的错误如果不依靠安全工具很难检出并修正，因此我们只能忽略掉这些安全问题。</p><blockquote><p><strong>Josh Reid</strong> (MythX)</p><p>Dec 5, 11:11 AST</p><p>Hello,</p><p>Thanks for reaching out to MythX support! We are currently investigating any potential issues that may be causing these vulnerabilities to not be displayed fully, however this may also be due to the vulnerabilities being detected only on the bytecode.</p><p>Unfortunately, at this time we do no have the ability to display bytecode vulnerabilities as we cannot specify where they are. However, this is something we are looking to evaluate and differentiate on more as we go forward. I apologize for any confusion this may have caused and will be sure to update you if we find any issues as we continue to look into this. In the meantime, thanks so much for your patience and cooperation! Is there anything else I can help you with at this time?</p><p>Best,</p><p>Josh</p></blockquote></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>The article was updated on 2019-12-06</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href="//twitter.com/share?url=https%3a%2f%2fshuzang.top%2f2019%2f12%2f%25E5%258C%25BA%25E5%259D%2597%25E9%2593%25BE%25E5%25AE%259E%25E9%25AA%258C7-%25E5%2590%2588%25E7%25BA%25A6%25E5%25AE%25A1%25E8%25AE%25A1%2f&text=%e5%8c%ba%e5%9d%97%e9%93%be%e5%ae%9e%e9%aa%8c7-%e5%90%88%e7%ba%a6%e5%ae%a1%e8%ae%a1&via=" target=_blank title="Share on Twitter"><i class="fab fa-twitter fa-fw"></i></a><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fshuzang.top%2f2019%2f12%2f%25E5%258C%25BA%25E5%259D%2597%25E9%2593%25BE%25E5%25AE%259E%25E9%25AA%258C7-%25E5%2590%2588%25E7%25BA%25A6%25E5%25AE%25A1%25E8%25AE%25A1%2f" target=_blank title="Share on Facebook"><i class="fab fa-facebook-square fa-fw"></i></a><a href="//reddit.com/submit?url=https%3a%2f%2fshuzang.top%2f2019%2f12%2f%25E5%258C%25BA%25E5%259D%2597%25E9%2593%25BE%25E5%25AE%259E%25E9%25AA%258C7-%25E5%2590%2588%25E7%25BA%25A6%25E5%25AE%25A1%25E8%25AE%25A1%2f&title=%e5%8c%ba%e5%9d%97%e9%93%be%e5%ae%9e%e9%aa%8c7-%e5%90%88%e7%ba%a6%e5%ae%a1%e8%ae%a1" target=_blank title="Share on Reddit"><i class="fab fa-reddit fa-fw"></i></a></span></div></div></div><div class=post-info-more><section><span class=tag><a href=https://shuzang.top/tags/%E8%AF%BE%E9%A2%98%E8%AE%B0%E5%BD%95/><i class="fas fa-tag fa-fw"></i>&nbsp;课题记录</a>&nbsp;</span></section><section><span><a href=javascript:window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=https://shuzang.top>Home</a></span></section></div><div class=post-nav><a href=https://shuzang.top/2019/12/life-skills-8-clothing-style-development-and-clothing-purchase/ class=prev rel=prev title=生活技能8-穿衣风格养成及衣服购买><i class="fas fa-angle-left fa-fw"></i>生活技能8-穿衣风格养成及衣服购买</a>
<a href=https://shuzang.top/2019/12/life-skills-9-maintenance-storage-and-disposal-of-used-clothes/ class=next rel=next title=生活技能9-保养、收纳及旧衣处理>生活技能9-保养、收纳及旧衣处理<i class="fas fa-angle-right fa-fw"></i></a></div></div><div class=post-comment><div id=vcomments></div><script src=/js/lib/valine/Valine.min.min.js></script><script type=text/javascript>(function(){if(window.location.hostname=="localhost")
return;new Valine({el:"#vcomments",appId:"GteMvevTjOBmhvFh2QGsopGO-gzGzoHsz",appKey:"fL4SYl06GIe012PswFdY17VC",meta:["nick","mail"],notify:"false",verify:"true",avatar:"hide",placeholder:"Your comment ...",visitor:"true",recordIP:"true",lang:"en",});})();</script><noscript>Please enable JavaScript to view the <a href=https://valine.js.org/>comments powered by Valine.</a></noscript></div></article></div></main><footer class=footer><div class=copyright><div class=copyright-line>Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreffer">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="external nofollow noopener noreffer">LoveIt<i class="far fa-heart fa-fw"></i></a></div><div class=copyright-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2018 - 2020</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://shuzang.top target=_blank>shuzang</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><a href=# class=dynamic-to-top id=dynamic-to-top data-scroll><span>&nbsp;</span>
</a><script src=https://cdn.bootcss.com/jquery/3.4.1/jquery.js></script><script src=https://cdn.bootcss.com/lazysizes/5.1.2/lazysizes.min.js></script><script src=https://cdn.bootcss.com/smooth-scroll/16.1.0/smooth-scroll.js></script><script>window.scroll=new SmoothScroll('[data-scroll]',{speed:300,speedAsDuration:true});</script><link href=https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css rel=stylesheet><script src=https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.js></script><script src=https://cdn.bootcss.com/KaTeX/0.11.1/contrib/auto-render.js></script><link href=https://cdn.bootcss.com/KaTeX/0.11.1/contrib/copy-tex.css rel=stylesheet><script src=https://cdn.bootcss.com/KaTeX/0.11.1/contrib/copy-tex.js></script><script src=https://cdn.bootcss.com/KaTeX/0.11.1/contrib/mhchem.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:true},{left:"\\(",right:"\\)",display:false},{left:"\\[",right:"\\]",display:true},{left:"$",right:"$",display:false},]});});</script><script src=/js/blog.min.js></script></body></html>